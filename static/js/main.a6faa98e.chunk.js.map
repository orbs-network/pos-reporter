{"version":3,"sources":["report.js","xls.js","App.js","index.js"],"names":["DefaultPeriodBlocks","DefaultAbsoluteStartBlock","getStartOfRewardsBlock","DefaultExcluded","web3Mapping","getWeb3","getWeb3Polygon","getPeriodsReport","ethereumEndpoint","networkType","nodeEndpoints","options","a","interestingGuardians","calculateDelegators","excluded","exclude_guardians","_","getGuardians","g","includes","address","push","certified","forEach","getGuardiansPeriodsReport","guardianAddresses","isString","web3","generatePeriodDetails","reportDetails","participants","i","length","getGuardianPeriodsReport","guardianAddress","rewards","console","log","trimNonFullPeriodIfNeeded","details","eth","getBlock","maxEndBlock","periods","periodLength","period_in_blocks","maxPeriods","show_only_full_periods","txs","currEnd","number","currStart","totalLength","start_block","start_block_time","end_block","end_block_time","Promise","all","res","Number","timestamp","number_of_periods","total_length_of_periods","start_of_periods_block","end_of_periods_block","report","readOptions","read_from_block","participantsRewards","getGuardian","gInfo","stack","sleep","generateGuardianPeriodResults","generateParticipantObject","allGuardianRewards","guardianSelfRewards","sumDelegatorRewards","generateAllDelegatorPaticipationRewads","guardian","guardianShareToTotal","reward_status","delegator_reward_share","guardianShareToAllDelegatorsShare","periodRewardsAsGuardian","generatePeriodReport","reward_as_guardian_slices","periodRewardsAsDelegator","reward_as_delegator_slices","periodDelegatorReward","map","v","guaridan","periodsData","periodRewards","currPeriod","currPeriodReward","isUndefined","guardian_from","block_number","total_awarded","deltaReward","deltaBlocks","neededDelta","generateTypedDelegatorPaticipationRewads","delegators","delegators_left","isHistoric","delegator","drewards","readRetryDelegator","getDelegatorStakingRewards","type","delegatorAddress","guardianName","name","guardianCertified","shift","ms","resolve","setTimeout","reportToXlsx","workbook","Workbook","worksheet","addWorksheet","views","state","ySplit","header2","header3","header4","totals","toDate","addRows","participant","row","addRow","totalsRow","getColumn","width","getRow","font","bold","j","getCell","value","border","top","style","right","numFmt","xlsx","writeBuffer","seconds","d","Date","toISOString","slice","providersEndpoints","providersNodesEndpoints","getReport","reportPeriodLength","reportNumberOfPeriods","reportShowOnlyFull","valueOf","downloadReport","reportFilenamePrefix","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","parentNode","removeChild","periodOptions","key","text","networkOptions","App","useState","reportType","reportPeriods","reportShowFull","input","setInput","loading","setLoading","handleChange","_e","handleSubmit","className","Container","textAlign","Segment","secondary","margin","Form","onSubmit","spellcheck","Select","label","defaultValue","onChange","Input","Checkbox","radio","checked","Button","primary","ReactDOM","render","StrictMode","getElementById"],"mappings":"qxBAWMA,EAAsB,OAEtBC,EAA4BC,mCAC5BC,EAAkB,CAAC,6CAA8C,8CACjEC,EAAc,CAAC,EAAKC,UAAS,IAAOC,kBAEnC,SAAeC,EAAtB,wC,4CAAO,WAAgCC,EAAkBC,EAAaC,EAAeC,GAA9E,mBAAAC,EAAA,6DACGC,EAAuB,GACvBC,EAAsB,GACtBC,EAAWJ,EAAQK,mBAAqBb,EAH3C,KAIHc,IAJG,SAIaC,uBAAaR,GAJ1B,+BAI0C,SAAAS,GACpCJ,EAASK,SAASD,EAAEE,WACrBR,EAAqBS,KAAKH,EAAEE,SAC5BP,EAAoBQ,MAAMH,EAAEI,aAPjC,KAIDC,QAJC,uCAWIC,EAA0BZ,EAAsBJ,EAAaK,EAAqBN,EAAkBG,IAXxG,6C,sBAcA,SAAec,EAAtB,0C,4CAAO,WAAyCC,EAAmBjB,EAAaK,EAAqBN,EAAkBG,GAAhH,qBAAAC,EAAA,0DACUK,IAAEU,SAASnB,GADrB,gCAC+CJ,EAAYK,GAAaD,GADxE,8CAC4FA,EAD5F,cACGoB,EADH,eAGyBC,EAAsBlB,EAASiB,GAHxD,QAGGE,EAHH,OAIGC,EAAe,GAEZC,EAAI,EANV,aAMYA,EAAIN,EAAkBO,QANlC,uCAQMF,EAAaT,KARnB,KAQMS,EARN,mBAQkCG,EAAyBR,EAAkBM,GAAIlB,EAAoBkB,GAAIJ,EAAME,GAR/G,2HAUKC,EAAaT,KAAK,CAACa,gBAAiBT,EAAkBM,GAAII,QAAS,KACnEC,QAAQC,IAAR,0CAA+CZ,EAAkBM,GAAjE,qCAXL,QAMyCA,IANzC,+BAeHO,EAA0BT,EAAeC,EAAcpB,GAfpD,kBAiBI,CACH6B,QAASV,EACTC,iBAnBD,4D,+BAwBQF,E,gFAAf,WAAqClB,EAASiB,GAA9C,iCAAAhB,EAAA,sEAC8BgB,EAAKa,IAAIC,SAAS,UADhD,OACUC,EADV,OAEUC,EAAU,GACVC,EAAelC,EAAQmC,kBAAoB9C,EAC3C+C,GAAcpC,EAAQiC,SA/CT,KA+C0E,IAAnCjC,EAAQqC,uBAAkC,EAAI,GAElGC,EAAM,GACRC,EAAUP,EAAYQ,OACtBC,EAAaT,EAAYQ,OAASN,EAAe,EAAK5C,EAA0BkD,OAC9ER,EAAYQ,QAAWR,EAAYQ,OAASlD,EAA0BkD,QAAUN,EAChF5C,EAA0BkD,OAC5BE,EAAc,EAClB,GACIT,EAAQtB,KAAK,CACTgC,YAAaF,EACbG,iBAAkB,EAClBC,UAAWN,EACXO,eAAgB,EAChBxB,OAAQiB,EAAQE,EAAU,IAE9BC,GAAgBH,EAAQE,EAAU,EAClCH,EAAI3B,KAAKM,EAAKa,IAAIC,SAASU,IAE3BA,GADAF,EAAUE,EAAY,GACAP,EAAe,QAChCD,EAAQX,OAASc,GAAcK,GAAanD,EAA0BkD,QAxBnF,iBA0BsBO,QAAQC,IAAIV,GA1BlC,QA2BI,IADMW,EA1BV,OA2BY5B,EAAI,EAAEA,EAAIY,EAAQX,OAAOD,IAC7BY,EAAQZ,GAAGyB,eAAiBI,OAAa,IAAN7B,EAAUW,EAAYmB,UAAYF,EAAI5B,EAAE,GAAG8B,UAAY,IAC1FlB,EAAQZ,GAAGuB,iBAAmBM,OAAOD,EAAI5B,GAAG8B,WA7BpD,yBAgCW,CACHC,kBAAmBnB,EAAQX,OAC3B+B,wBAAyBX,EACzBY,uBAAwBrB,EAAQA,EAAQX,OAAO,GAAGqB,YAClDY,qBAAsBtB,EAAQ,GAAGY,UACjCZ,YArCR,6C,+BAyCeV,E,oFAAf,WAAwCb,EAASP,EAAqBc,EAAMuC,GAA5E,qBAAAvD,EAAA,6DACUwD,EAAc,CAChBC,gBAAiBF,EAAOF,uBAAyB,KAE/CK,EAAsB,GAJhC,kBAQsBC,sBAAYlD,EAASO,EAAMwC,GARjD,OAQQI,EARR,8DAUQnC,QAAQC,IAAR,0CAA+CjB,EAA/C,aAA2D,KAAEoD,MAA7D,8BACAC,EAAM,KAXd,UAYsBH,sBAAYlD,EAASO,EAAMwC,GAZjD,QAYQI,EAZR,kBAcUZ,EAAMe,EAA8BH,EAAOL,EAAOvB,SACxD0B,EAAoBhD,KAAKsD,EAA0BJ,EAAO,QAASZ,EAAIiB,qBACvEP,EAAoBhD,KAAKsD,EAA0BJ,EAAO,wCAAyCZ,EAAIkB,sBACvGR,EAAoBhD,KAAKsD,EAA0BJ,EAAO,mBAAoBZ,EAAImB,uBAE9EjE,EAnBR,kCAoBckE,EAAuCR,EAAO5C,EAAMwC,EAAaD,EAAOvB,QAAS0B,GApB/F,iCAuBWA,GAvBX,0D,sBA0BA,SAASK,EAA8BM,EAAUrC,GAO7C,IANA,IAAMsC,EAAuB,GAAO,EAAID,EAASE,cAAcC,wBACzDC,EAAoCJ,EAASE,cAAcC,wBAA0B,EAAEH,EAASE,cAAcC,wBAE9GE,EAA0BC,EAAqBN,EAASO,0BAA2BP,EAAS5D,QAASuB,GACrG6C,EAA2BF,EAAqBN,EAASS,2BAA4BT,EAAS5D,QAASuB,GACvGkC,EAAsB,GAAIC,EAAsB,GAC9C/C,EAAI,EAAEA,EAAIsD,EAAwBrD,OAAOD,IAAK,CAClD,IAAM2D,EAAwB3D,EAAIyD,EAAyBxD,OAASwD,EAAyBzD,GAAK,EAClG8C,EAAoBxD,KAAKgE,EAAwBtD,GAAK2D,GACtDZ,EAAoBzD,KAAKgE,EAAwBtD,GAAKqD,EAAoCM,GAG9F,MAAO,CACHd,mBAAoB5D,IAAE2E,IAAIN,GAAyB,SAAAO,GAAC,OAAIA,EAAIX,KAC5DH,sBACAD,uBAOR,SAASS,EAAqBnD,EAAS0D,EAAUC,GAI7C,IAHA,IAAMC,EAAgB,GAClBC,EAAa,EACbC,EAAmB,EACdlE,EAAI,EAAEiE,EAAaF,EAAY9D,QAAUD,EAAII,EAAQH,OAAO,EAAED,IACnE,GAAIf,IAAEkF,YAAY/D,EAAQJ,GAAGoE,gBAAkBhE,EAAQJ,GAAGoE,gBAAkBN,EACxE,GAAI1D,EAAQJ,EAAE,GAAGqE,cAAgBN,EAAYE,GAAY3C,YACrD4C,GAAoB9D,EAAQJ,GAAGsE,cAAgBlE,EAAQJ,EAAE,GAAGsE,kBACzD,CACH,IAAMC,EAAcnE,EAAQJ,GAAGsE,cAAgBlE,EAAQJ,EAAE,GAAGsE,cACtDE,EAAcpE,EAAQJ,GAAGqE,aAAejE,EAAQJ,EAAE,GAAGqE,aAErDI,EAAcF,GADMnE,EAAQJ,GAAGqE,aAAeN,EAAYE,GAAY3C,YAAc,GACpCkD,EACtDN,GAAoBO,EACpBT,EAAc1E,KAAK4E,GAEnBA,EAAmBK,EAAcE,EACjCR,SAEG7D,EAAQJ,EAAE,GAAGqE,cAAgBN,EAAYE,GAAY3C,cAC5D0C,EAAc1E,KAAK4E,GACnBA,EAAmB,EACnBD,KAOR,OAJIA,EAAaF,EAAY9D,QACzB+D,EAAc1E,KAAK4E,GAGhBF,E,SAGIhB,E,sFAAf,WAAsDC,EAAUrD,EAAMjB,EAASiC,EAAS0B,GAAxF,SAAA1D,EAAA,sEACU8F,EAAyCzB,EAAUA,EAAS0B,YAAY,EAAO/E,EAAMjB,EAASiC,EAAS0B,GADjH,uBAEUoC,EAAyCzB,EAAUA,EAAS2B,iBAAiB,EAAMhF,EAAMjB,EAASiC,EAAS0B,GAFrH,4C,+BAKeoC,E,0FAAf,WAAwDzB,EAAU0B,EAAYE,EAAYjF,EAAMjB,EAASiC,EAAS0B,GAAlH,qBAAA1D,EAAA,oEAC4B+F,GAD5B,gEACeG,EADf,QAEYC,EAAW,GAFvB,cAIuBxB,EAJvB,UAIkDyB,EAAmBF,EAAUzF,QAASO,EAAMjB,GAJ9F,yBAIwGsE,EAAS5D,QAJjH,KAI0HuB,EAA9GmE,GAJZ,0EAMY1E,QAAQC,IAAR,iCAAsCuE,EAAa,aAAe,GAAlE,sBAAmFC,EAAUzF,QAA7F,aAAyG,KAAEoD,MAA3G,mBANZ,QAQQH,EAAoBhD,KAAKsD,EAA0BK,EAAU4B,EAAa,uBAAwB,YAAaE,EAAUD,EAAUzF,UAR3I,+M,+BAYe2F,E,kFAAf,WAAkC3F,EAASO,EAAMjB,GAAjD,SAAAC,EAAA,+EAEsBqG,qCAA2B5F,EAASO,EAAMjB,GAFhE,+CAM0EyB,SAN1E,uCAIQC,QAAQC,IAAR,2CAAgDjB,EAAhD,aAA4D,KAAEoD,MAA9D,8BACAC,EAAM,KALd,UAMsBuC,qCAA2B5F,EAASO,EAAMjB,GANhE,0D,sBAUA,SAASiE,EAA0BK,EAAUiC,EAAM9E,EAAS+E,GACxD,MAAO,CACHhF,gBAAiB8C,EAAS5D,QAC1B+F,aAAcnC,EAASzC,QAAQ6E,KAC/BC,kBAAmBrC,EAASzC,QAAQjB,UACpC2F,OACAC,mBACA/E,WAIR,SAASG,EAA0BC,EAAST,EAAcpB,GACtD,IAAMkC,EAAelC,EAAQmC,kBAAoB9C,EACjD,GAAIwC,EAAQI,QAAQX,OAAS,GAAKO,EAAQI,QAAQ,GAAGX,OAASY,IAAmD,IAAnClC,EAAQqC,uBAAiC,CACnHR,EAAQwB,wBAA0BxB,EAAQwB,wBAA0BxB,EAAQI,QAAQ,GAAGX,OACvFO,EAAQI,QAAQ2E,QAChB/E,EAAQuB,kBAAoBvB,EAAQuB,kBAAoB,EACxDvB,EAAQ0B,qBAAuB1B,EAAQI,QAAQ,GAAGY,UAJiE,oBAKzFzB,GALyF,IAKnH,2BAAwC,SACxBK,QAAQmF,SAN2F,gCAW3H,SAAS7C,EAAM8C,GACX,OAAO,IAAI9D,SAAQ,SAAC+D,GAAD,OAAaC,WAAWD,EAASD,M,aC3NjD,SAAeG,EAAtB,kC,4CAAO,WAA4BxD,GAA5B,mDAAAvD,EAAA,sDAOH,IANMgH,EAAW,IAAIC,WACfC,EAAYF,EAASG,aAAa,SAAU,CAACC,MAAM,CAAC,CAACC,MAAO,SAAUC,OAAQ,MAG9EC,EAAU,CAAC,GAAG,GAAG,GAAG,GAAG,IAAKC,EAAU,CAAC,GAAG,GAAG,GAAG,GAAG,IAAKC,EAAU,CAAC,mBAAmB,gBAAiB,YAAa,OAAQ,oBAC5HC,EAAS,GACPtG,EAAImC,EAAO3B,QAAQuB,kBAAkB,EAAE/B,GAAK,EAAEA,IAClDmG,EAAQ7G,KAAR,UAAgBiH,EAAOpE,EAAO3B,QAAQI,QAAQZ,GAAGuB,kBAAjD,eAAyEgF,EAAOpE,EAAO3B,QAAQI,QAAQZ,GAAGyB,gBAA1G,SACA2E,EAAQ9G,KAAR,UAAgB6C,EAAO3B,QAAQI,QAAQZ,GAAGsB,YAA1C,eAA4Da,EAAO3B,QAAQI,QAAQZ,GAAGwB,UAAtF,aAAoGW,EAAO3B,QAAQI,QAAQZ,GAAGC,OAA9H,aACAoG,EAAQ/G,KAAK,sBACbgH,EAAOhH,KAAK,GAEhBwG,EAAUU,QAAQ,CAACL,EAASC,EAASC,IAblC,cAgBuBlE,EAAOpC,cAhB9B,IAgBH,2BAA+C,CAK3C,GALO0G,EAAoC,QACrCC,EAAM,CACRD,EAAYtG,gBAAiBsG,EAAYrB,aAAcqB,EAAYnB,kBACnEmB,EAAYvB,KAAMuB,EAAYtB,kBAAoB,IAEnB,IAA/BsB,EAAYrG,QAAQH,OACpByG,EAAIpH,KAAK,oBACN,CACH,IAAQU,EAAIyG,EAAYrG,QAAQH,OAAOD,EAAImC,EAAO3B,QAAQuB,kBAAkB/B,IACxE0G,EAAIpH,KAAK,GAEb,IAASU,EAAIyG,EAAYrG,QAAQH,OAAO,EAAED,GAAI,EAAEA,IAC5C0G,EAAIpH,KAAKmH,EAAYrG,QAAQJ,IACJ,UAArByG,EAAYvB,OACZoB,EAAOnE,EAAO3B,QAAQuB,kBAAkB,EAAE/B,GAAKsG,EAAOnE,EAAO3B,QAAQuB,kBAAkB,EAAE/B,GAAKyG,EAAYrG,QAAQJ,IAI9H8F,EAAUa,OAAOD,IAlClB,8BA6CH,IARME,EAAYd,EAAUa,OAAV,CAAkB,GAAG,GAAG,GAAG,GAAG,sBAA9B,OAAuDL,IAGzER,EAAUe,UAAU,GAAGC,MAAQ,GAC/BhB,EAAUe,UAAU,GAAGC,MAAQ,GAC/BhB,EAAUe,UAAU,GAAGC,MAAQ,EAC/BhB,EAAUe,UAAU,GAAGC,MAAQ,GAC/BhB,EAAUe,UAAU,GAAGC,MAAQ,GACvB9G,EAAI,EAAEA,EAAImC,EAAO3B,QAAQuB,kBAAkB/B,IAC/C8F,EAAUe,UAAU,EAAE7G,GAAG8G,MAAQ,GAGrC,IADAhB,EAAUiB,OAAO,GAAGC,KAAO,CAACC,MAAM,GAC1BC,EAAE,EAAEA,EAAI,EAAE/E,EAAOpC,aAAaE,OAAOiH,IASzC,IAP6B,WADvBR,EAAMZ,EAAUiB,OAAOG,IACrBC,QAAQ,GAAGC,OACfV,EAAIM,KAAO,CAACC,MAAM,GAClBP,EAAIW,OAAS,CAACC,IAAK,CAACC,MAAM,SAC1Bb,EAAIS,QAAQ,GAAGE,OAAS,CAACC,IAAK,CAACC,MAAM,QAASC,MAAO,CAACD,MAAM,UAE5Db,EAAIS,QAAQ,GAAGE,OAAS,CAACG,MAAO,CAACD,MAAM,SAEnCvH,EAAI,EAAEA,EAAI,EAAImC,EAAO3B,QAAQuB,kBAAkB/B,IACnD0G,EAAIS,QAAQnH,GAAGyH,OAAS,WAUhC,IANAb,EAAUI,KAAO,CAACC,MAAM,GACxBL,EAAUO,QAAQ,GAAGE,OAAS,CAACC,IAAK,CAACC,MAAM,SAC3CX,EAAUO,QAAQ,GAAGE,OAAS,CAACC,IAAK,CAACC,MAAM,SAC3CX,EAAUO,QAAQ,GAAGE,OAAS,CAACC,IAAK,CAACC,MAAM,SAC3CX,EAAUO,QAAQ,GAAGE,OAAS,CAACC,IAAK,CAACC,MAAM,SAC3CX,EAAUO,QAAQ,GAAGE,OAAS,CAACC,IAAK,CAACC,MAAM,QAASC,MAAO,CAACD,MAAM,SAC1DvH,EAAI,EAAEA,EAAI,EAAImC,EAAO3B,QAAQuB,kBAAkB/B,IAClD4G,EAAUO,QAAQnH,GAAGyH,OAAS,WAC9Bb,EAAUO,QAAQnH,GAAGqH,OAAS,CAACC,IAAK,CAACC,MAAM,WAvE7C,yBA0EI3B,EAAS8B,KAAKC,eA1ElB,6C,sBA6EP,SAASpB,EAAOqB,GACZ,IAAMC,EAAI,IAAIC,KAAe,IAAVF,GAAgBG,cACnC,OAAOF,EAAEG,MAAM,EAAE,IAAM,IAAMH,EAAEG,MAAM,GAAG,I,YC3EtCC,EAAqB,CACzB,EAAK,gEACL,IAAO,6EAEHC,EAA0B,CAC9B,EAAK,CAAC,iEACN,IAAO,CAAC,oE,SAEKC,E,oFAAf,WAAyBC,EAAoB3J,EAAa4J,EAAuBC,GAAjF,qBAAA1J,EAAA,6DACQJ,EAAmByJ,EAAmBxJ,GACtCC,EAAgBwJ,EAAwBzJ,GAExCE,EAAU,CACdmC,iBAAkB,IAAIe,OAAOuG,GAAoBG,UACjD3H,QAAS,IAAIiB,OAAOwG,GAAuBE,UAC3CvH,uBAA+C,SAAvBsH,GAP5B,SAWuB/J,EAAiBC,EAAkBC,EAAaC,EAAeC,GAXtF,cAWQwD,EAXR,yBAYSwD,EAAaxD,IAZtB,4C,sBAeA,SAASqG,EAAerG,EAAQsG,GAC9B,IAAMC,EAAMC,OAAOC,IAAIC,gBAAgB,IAAIC,KAAK,CAAC3G,KAC3C4G,EAAOC,SAASC,cAAc,KACpCF,EAAKG,KAAOR,EACZK,EAAKI,aAAa,WAAlB,UAAiCV,EAAjC,aAAyD,IAAIX,MAAOC,cAApE,UACAgB,EAAKI,aAAa,OAAQ,qEAC1BH,SAASI,KAAKC,YAAYN,GAC1BA,EAAKO,QACLP,EAAKQ,WAAWC,YAAYT,GAG9B,IAAMU,GAAgB,CACpB,CACEC,IAAK,YACLC,KAAM,sBACNvC,MAAO,UAET,CACEsC,IAAK,UACLC,KAAM,oBACNvC,MAAO,UAET,CACEsC,IAAK,SACLC,KAAM,kBACNvC,MAAO,UAILwC,GAAgB,CACpB,CACEF,IAAK,WACLC,KAAM,WACNvC,MAAO,KAET,CACEsC,IAAK,UACLC,KAAM,UACNvC,MAAO,QAyEIyC,OArEf,WACE,MAA0BC,mBAAS,CAACC,WAAY,SAAUtL,YAAa,IAAKuL,cAAe,IAAKC,eAAgB,QAASxB,qBAAsB,WAA/I,mBAAOyB,EAAP,KAAcC,EAAd,KACA,EAA8BL,oBAAS,GAAvC,mBAAOM,EAAP,KAAgBC,EAAhB,KACMC,EAAe,SAACC,EAAD,OAAOlF,EAAP,EAAOA,KAAM+B,EAAb,EAAaA,MAAb,OAAyB+C,EAAS,2BAAKD,GAAN,kBAAc7E,EAAO+B,MACrEoD,EAAY,uCAAG,oCAAA5L,EAAA,6DACXmL,EAAiFG,EAAjFH,WAAYtL,EAAqEyL,EAArEzL,YAAauL,EAAwDE,EAAxDF,cAAeC,EAAyCC,EAAzCD,eAAgBxB,EAAyByB,EAAzBzB,qBAChE4B,GAAW,GAFQ,SAGElC,EAAU4B,EAAYtL,EAAauL,EAAeC,GAHpD,OAInBzB,EAJmB,OAIIC,GACvB4B,GAAW,GALQ,2CAAH,qDAQlB,OACI,sBAAKI,UAAU,MAAf,UACE,+DACA,uBACA,cAACC,EAAA,EAAD,CAAWC,UAAU,OAArB,SACE,cAACC,EAAA,EAAD,CAASD,UAAU,OAAOE,WAAS,EAACtD,MAAO,CAAET,MAAO,OAAQgE,OAAQ,QAApE,SACE,eAACC,EAAA,EAAD,CAAMX,QAASA,EAASY,SAAUR,EAAcS,WAAW,QAA3D,UACE,cAACF,EAAA,EAAKG,OAAN,CACIC,MAAM,UACN9F,KAAK,cACL1G,QAASiL,GACTwB,aAAa,IACbC,SAAUf,IAEd,cAACS,EAAA,EAAKG,OAAN,CACIC,MAAM,cACN9F,KAAK,aACL1G,QAAS8K,GACT2B,aAAa,SACbC,SAAUf,IAEd,cAACS,EAAA,EAAKO,MAAN,CACIH,MAAM,2BACN9F,KAAK,gBACL+F,aAAa,IACbC,SAAUf,IAEd,cAACS,EAAA,EAAKQ,SAAN,CACIC,OAAK,EACLL,MAAM,yBACN9F,KAAK,iBACL+B,MAAM,OACNqE,QAAkC,SAAzBvB,EAAMD,eACfoB,SAAUf,IAEd,cAACS,EAAA,EAAKQ,SAAN,CACIC,OAAK,EACLL,MAAM,2BACN9F,KAAK,iBACL+B,MAAM,QACNqE,QAAkC,UAAzBvB,EAAMD,eACfoB,SAAUf,IAEd,cAACS,EAAA,EAAKO,MAAN,CACIH,MAAM,mBACN9F,KAAK,uBACL+F,aAAa,SACbC,SAAUf,IAEd,cAACS,EAAA,EAAKW,OAAN,CAAaC,SAAO,EAApB,+BC9HdC,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEF9C,SAAS+C,eAAe,W","file":"static/js/main.a6faa98e.chunk.js","sourcesContent":["/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport _  from 'lodash';\nimport { getDelegatorStakingRewards, getGuardian, getGuardians, getStartOfRewardsBlock, getWeb3, getWeb3Polygon } from \"@orbs-network/pos-analytics-lib\";\n\nconst DefaultPeriodBlocks = 604800;\nconst DefualtPeriods = 3;\nconst DefaultAbsoluteStartBlock = getStartOfRewardsBlock();\nconst DefaultExcluded = ['0x4aca0c63e351b2ea44ee628425710e933b5b3396', '0xca0ff0479bd7f52e55e65da7b76074b477b734b3'];\nconst web3Mapping = {'1': getWeb3, '137': getWeb3Polygon}\n\nexport async function getPeriodsReport(ethereumEndpoint, networkType, nodeEndpoints, options) {\n    const interestingGuardians = [];\n    const calculateDelegators = [];\n    const excluded = options.exclude_guardians || DefaultExcluded;\n    _.forEach(await getGuardians(nodeEndpoints), g => {\n        if (!excluded.includes(g.address)) {\n            interestingGuardians.push(g.address);\n            calculateDelegators.push(!g.certified);\n        }\n    });\n\n    return getGuardiansPeriodsReport(interestingGuardians, networkType, calculateDelegators, ethereumEndpoint, options);\n}\n\nexport async function getGuardiansPeriodsReport(guardianAddresses, networkType, calculateDelegators, ethereumEndpoint, options) {\n    const web3 = _.isString(ethereumEndpoint) ? await web3Mapping[networkType](ethereumEndpoint) : ethereumEndpoint;\n\n    const reportDetails = await generatePeriodDetails(options, web3);\n    const participants = [];\n\n    for (let i = 0;i < guardianAddresses.length;i++) {\n        try {\n             participants.push(...(await getGuardianPeriodsReport(guardianAddresses[i], calculateDelegators[i], web3, reportDetails)));\n        } catch (e) {\n            participants.push({guardianAddress: guardianAddresses[i], rewards: []});\n            console.log(`Error while generating guardian ${guardianAddresses[i]}: ${e} ... (skipped)`);\n        }\n    }\n\n    trimNonFullPeriodIfNeeded(reportDetails, participants, options);\n    \n    return {\n        details: reportDetails,\n        participants\n    }\n}\n\n// Generate full periods + partial (data always starts from )\nasync function generatePeriodDetails(options, web3) {\n    const maxEndBlock = await web3.eth.getBlock('latest');\n    const periods = []; \n    const periodLength = options.period_in_blocks || DefaultPeriodBlocks;\n    const maxPeriods = (options.periods || DefualtPeriods) + (options.show_only_full_periods === true ? 1 : 0);\n\n    const txs = [];\n    let currEnd = maxEndBlock.number;\n    let currStart = (maxEndBlock.number - periodLength + 1) > DefaultAbsoluteStartBlock.number\n        ? maxEndBlock.number - ((maxEndBlock.number - DefaultAbsoluteStartBlock.number) % periodLength)\n        : DefaultAbsoluteStartBlock.number;\n    let totalLength = 0;\n    do {\n        periods.push({\n            start_block: currStart,\n            start_block_time: 0,\n            end_block: currEnd,\n            end_block_time: 0,\n            length: currEnd-currStart+1\n        });\n        totalLength += (currEnd-currStart+1);\n        txs.push(web3.eth.getBlock(currStart));\n        currEnd = currStart - 1;\n        currStart = currEnd - periodLength + 1;    \n    } while (periods.length < maxPeriods && currStart >= DefaultAbsoluteStartBlock.number)\n\n    const res = await Promise.all(txs);\n    for(let i = 0;i < periods.length;i++) {\n        periods[i].end_block_time = Number(i === 0 ? maxEndBlock.timestamp : res[i-1].timestamp - 13);\n        periods[i].start_block_time = Number(res[i].timestamp);\n    }\n \n    return {\n        number_of_periods: periods.length,\n        total_length_of_periods: totalLength,\n        start_of_periods_block: periods[periods.length-1].start_block,\n        end_of_periods_block: periods[0].end_block, \n        periods,\n    }\n}\n\nasync function getGuardianPeriodsReport(address, calculateDelegators, web3, report) {\n    const readOptions = {\n        read_from_block: report.start_of_periods_block - 10000, /* need cushion for event to have before first block */\n    }\n    const participantsRewards = [];\n\n    let gInfo;\n    try {\n        gInfo = await getGuardian(address, web3, readOptions);\n    } catch (e) {\n        console.log(`Error while generating guardian ${address}: ${e.stack} ... (going to retry now)`);\n        sleep(1000); // just in case\n        gInfo = await getGuardian(address, web3, readOptions);\n    }\n    const res = generateGuardianPeriodResults(gInfo, report.periods);\n    participantsRewards.push(generateParticipantObject(gInfo, 'Total', res.allGuardianRewards));\n    participantsRewards.push(generateParticipantObject(gInfo, 'Self-Share (guardian + self-delegate)', res.guardianSelfRewards));\n    participantsRewards.push(generateParticipantObject(gInfo, 'Total Delegators', res.sumDelegatorRewards));\n\n    if (calculateDelegators) {\n        await generateAllDelegatorPaticipationRewads(gInfo, web3, readOptions, report.periods, participantsRewards);\n    }\n\n    return participantsRewards;\n}\n\nfunction generateGuardianPeriodResults(guardian, periods) {\n    const guardianShareToTotal = 1.0 / (1.0-guardian.reward_status.delegator_reward_share);\n    const guardianShareToAllDelegatorsShare = guardian.reward_status.delegator_reward_share / (1-guardian.reward_status.delegator_reward_share);\n\n    const periodRewardsAsGuardian = generatePeriodReport(guardian.reward_as_guardian_slices, guardian.address, periods);\n    const periodRewardsAsDelegator = generatePeriodReport(guardian.reward_as_delegator_slices, guardian.address, periods);\n    const guardianSelfRewards = [], sumDelegatorRewards = [];\n    for(let i = 0;i < periodRewardsAsGuardian.length;i++) {\n        const periodDelegatorReward = i < periodRewardsAsDelegator.length ? periodRewardsAsDelegator[i] : 0\n        guardianSelfRewards.push(periodRewardsAsGuardian[i] + periodDelegatorReward);\n        sumDelegatorRewards.push(periodRewardsAsGuardian[i] * guardianShareToAllDelegatorsShare - periodDelegatorReward);\n    }\n\n    return { \n        allGuardianRewards: _.map(periodRewardsAsGuardian, v => v * guardianShareToTotal),\n        sumDelegatorRewards, \n        guardianSelfRewards\n    };\n}\n\n// Assumptions:\n// 1. eigher the last reward is begining of time or there are more than needed.\n// 2. for delegators an assignreward event happends when change of delegation.\nfunction generatePeriodReport(rewards, guaridan, periodsData) {\n    const periodRewards = [];\n    let currPeriod = 0;\n    let currPeriodReward = 0;\n    for (let i = 0;currPeriod < periodsData.length && i < rewards.length-1;i++) {\n        if (_.isUndefined(rewards[i].guardian_from) || rewards[i].guardian_from === guaridan) { // count this delta\n            if (rewards[i+1].block_number >= periodsData[currPeriod].start_block) { // full 'delta' counted\n                currPeriodReward += rewards[i].total_awarded - rewards[i+1].total_awarded;\n            } else { // partial 'delta' counted \n                const deltaReward = rewards[i].total_awarded - rewards[i+1].total_awarded;\n                const deltaBlocks = rewards[i].block_number - rewards[i+1].block_number;\n                const neededDeltaBlocks = rewards[i].block_number - periodsData[currPeriod].start_block + 1;\n                const neededDelta = deltaReward * neededDeltaBlocks / deltaBlocks\n                currPeriodReward += neededDelta;\n                periodRewards.push(currPeriodReward);\n   \n                currPeriodReward = deltaReward - neededDelta;\n                currPeriod++;            \n            }\n        } else if (rewards[i+1].block_number <= periodsData[currPeriod].start_block) { // just check if next period\n            periodRewards.push(currPeriodReward);\n            currPeriodReward = 0;\n            currPeriod++;            \n        } \n    }\n    if (currPeriod < periodsData.length) {\n        periodRewards.push(currPeriodReward);\n    }\n\n    return periodRewards;\n}\n\nasync function generateAllDelegatorPaticipationRewads(guardian, web3, options, periods, participantsRewards) {\n    await generateTypedDelegatorPaticipationRewads(guardian, guardian.delegators, false, web3, options, periods, participantsRewards);\n    await generateTypedDelegatorPaticipationRewads(guardian, guardian.delegators_left, true, web3, options, periods, participantsRewards);\n}\n\nasync function generateTypedDelegatorPaticipationRewads(guardian, delegators, isHistoric, web3, options, periods, participantsRewards) {\n    for (const delegator of delegators) {\n        let drewards = []\n        try {\n            drewards = generatePeriodReport(await readRetryDelegator(delegator.address, web3, options), guardian.address, periods);\n        } catch (e) {\n            console.log(`Error while generating ${isHistoric ? \"historical\" : \"\" } delegator ${delegator.address}: ${e.stack} ... (skipped)`);\n        }\n        participantsRewards.push(generateParticipantObject(guardian, isHistoric ? 'Historical Delegator': 'Delegator', drewards, delegator.address));\n    }\n}\n\nasync function readRetryDelegator(address, web3, options) {\n    try {\n        return (await getDelegatorStakingRewards(address, web3, options)).rewards;\n    } catch (e) {\n        console.log(`Error while generating delegator ${address}: ${e.stack} ... (going to retry now)`);\n        sleep(1000); // just in case\n        return (await getDelegatorStakingRewards(address, web3, options)).rewards;\n    }\n}\n\nfunction generateParticipantObject(guardian, type, rewards, delegatorAddress) {\n    return {\n        guardianAddress: guardian.address,\n        guardianName: guardian.details.name,\n        guardianCertified: guardian.details.certified,\n        type,\n        delegatorAddress,\n        rewards\n    };\n}\n\nfunction trimNonFullPeriodIfNeeded(details, participants, options) {\n    const periodLength = options.period_in_blocks || DefaultPeriodBlocks;\n    if (details.periods.length > 1 && details.periods[0].length < periodLength && options.show_only_full_periods === true) {\n        details.total_length_of_periods = details.total_length_of_periods - details.periods[0].length;\n        details.periods.shift();\n        details.number_of_periods = details.number_of_periods - 1;\n        details.end_of_periods_block = details.periods[0].end_block;\n        for (const participant of participants) {\n            participant.rewards.shift();\n        }\n    }\n}\n\nfunction sleep(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter library in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport {Workbook} from 'exceljs';\n\nexport async function reportToXlsx(report) {\n    const workbook = new Workbook();  \n    const worksheet = workbook.addWorksheet('Report', {views:[{state: 'frozen', ySplit: 3}]});  \n    \n    // headers\n    const header2 = ['','','','',''], header3 = ['','','','',''], header4 = ['Guardian Address','Guardian Name', 'Certified', 'Type', 'Delegaor Address'];\n    const totals = [];\n    for(let i = report.details.number_of_periods-1;i >= 0;i--) {\n        header2.push(`${toDate(report.details.periods[i].start_block_time)} to ${toDate(report.details.periods[i].end_block_time)} GMT`);\n        header3.push(`${report.details.periods[i].start_block} to ${report.details.periods[i].end_block} (${report.details.periods[i].length} blocks)`)\n        header4.push('Distributed (ORBS)');\n        totals.push(0);\n    }\n    worksheet.addRows([header2, header3, header4]);\n\n    // data\n    for (const participant of report.participants) {\n        const row = [\n            participant.guardianAddress, participant.guardianName, participant.guardianCertified, \n            participant.type, participant.delegatorAddress || ''\n        ];\n        if (participant.rewards.length === 0) {\n            row.push('Missing Data');\n        } else { \n            for(let i = participant.rewards.length;i < report.details.number_of_periods;i++) {\n                row.push(0);\n            }\n            for (let i = participant.rewards.length-1;i >=0;i--) {\n                row.push(participant.rewards[i]);\n                if (participant.type === 'Total') { // notice the reverse order :)\n                    totals[report.details.number_of_periods-1-i] = totals[report.details.number_of_periods-1-i] + participant.rewards[i];\n                }\n            }\n        }\n        worksheet.addRow(row);\n    }\n    //worksheet.getCell('A3').value = { formula: 'A1+A2', result: 7 };\n    const totalsRow = worksheet.addRow(['','','','','Total Distributed:', ...totals]);\n    \n    // formatting\n    worksheet.getColumn(1).width = 42;\n    worksheet.getColumn(2).width = 35;\n    worksheet.getColumn(3).width = 8;\n    worksheet.getColumn(4).width = 35;\n    worksheet.getColumn(5).width = 42;\n    for(let i = 0;i < report.details.number_of_periods;i++) {\n        worksheet.getColumn(6+i).width = 40;  \n    }\n    worksheet.getRow(3).font = {bold: true};\n    for(let j=4;j < 4+report.participants.length;j++) {\n        const row = worksheet.getRow(j);\n        if (row.getCell(4).value === 'Total') {\n            row.font = {bold: true};\n            row.border = {top: {style:'thin'}};\n            row.getCell(5).border = {top: {style:'thin'}, right: {style:'thin'}};\n        } else {\n            row.getCell(5).border = {right: {style:'thin'}};\n        }\n        for(let i = 6;i < 6 + report.details.number_of_periods;i++) {\n            row.getCell(i).numFmt = \"#,##0.00\";\n        }\n\n    }\n    totalsRow.font = {bold: true};\n    totalsRow.getCell(1).border = {top: {style:'thin'}};\n    totalsRow.getCell(2).border = {top: {style:'thin'}};\n    totalsRow.getCell(3).border = {top: {style:'thin'}};\n    totalsRow.getCell(4).border = {top: {style:'thin'}};\n    totalsRow.getCell(5).border = {top: {style:'thin'}, right: {style:'thin'}};\n    for(let i = 6;i < 6 + report.details.number_of_periods;i++) {\n         totalsRow.getCell(i).numFmt = \"#,##0.00\";\n         totalsRow.getCell(i).border = {top: {style:'double'}};\n    }\n    \n    return workbook.xlsx.writeBuffer()\n}\n\nfunction toDate(seconds) {\n    const d = new Date(seconds * 1000).toISOString();\n    return d.slice(0,10) + ' ' + d.slice(11,19);\n}\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport React, { useState } from \"react\";\nimport { Container, Segment, Form } from \"semantic-ui-react\";\nimport \"./App.css\";\n\nimport { getGuardiansPeriodsReport, getPeriodsReport } from './report.js';\nimport { reportToXlsx } from './xls.js';\nconst providersEndpoints = {\n  '1': 'https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9',\n  '137': 'https://polygon-mainnet.g.alchemy.com/v2/c93z5UqYd5bR2paVR7PtUXhkVEIDIex0'\n}\nconst providersNodesEndpoints = {\n  '1': ['https://0xcore-management-direct.global.ssl.fastly.net/status'],\n  '137': ['https://0xcore-matic-reader-direct.global.ssl.fastly.net/status']\n}\nasync function getReport(reportPeriodLength, networkType, reportNumberOfPeriods, reportShowOnlyFull) {\n  const ethereumEndpoint = providersEndpoints[networkType];\n  const nodeEndpoints = providersNodesEndpoints[networkType];\n\n  const options = {\n    period_in_blocks: new Number(reportPeriodLength).valueOf(),\n    periods: new Number(reportNumberOfPeriods).valueOf(),\n    show_only_full_periods: reportShowOnlyFull === 'true'\n  };\n\n  //const report = await getGuardiansPeriodsReport(guardianAddresses, includeDelegators, ethereumEndpoint, options);\n  const report = await getPeriodsReport(ethereumEndpoint, networkType, nodeEndpoints, options)\n  return reportToXlsx(report);\n}\n\nfunction downloadReport(report, reportFilenamePrefix) {\n  const url = window.URL.createObjectURL(new Blob([report]));\n  const link = document.createElement('a');\n  link.href = url;\n  link.setAttribute('download', `${reportFilenamePrefix}.${new Date().toISOString()}.xlsx`);\n  link.setAttribute('type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n  document.body.appendChild(link);\n  link.click();\n  link.parentNode.removeChild(link);\n}\n\nconst periodOptions = [\n  {\n    key: 'Quarterly',\n    text: 'Quarterly (91 days)',\n    value: '604800'\n  },\n  {\n    key: 'Monthly',\n    text: 'Monthly (30 days)',\n    value: '199385'\n  },\n  {\n    key: 'Weekly',\n    text: 'Weekly (7 days)',\n    value: '46525'\n  }\n];\n\nconst networkOptions =[\n  {\n    key: 'Ethereum',\n    text: 'Ethereum',\n    value: '1'\n  },\n  {\n    key: 'Polygon',\n    text: 'Polygon',\n    value: '137'\n  }\n];\n\nfunction App() {\n  const [input, setInput] = useState({reportType: '604800', networkType: '1', reportPeriods: '3', reportShowFull: 'false', reportFilenamePrefix: \"report\"});\n  const [loading, setLoading] = useState(false);\n  const handleChange = (_e, { name, value }) => setInput({ ...input, [name]: value });\n  const handleSubmit = async () => {\n    const { reportType, networkType, reportPeriods, reportShowFull, reportFilenamePrefix } = input;\n    setLoading(true);\n    const result = await getReport(reportType, networkType, reportPeriods, reportShowFull);\n    downloadReport(result, reportFilenamePrefix);\n    setLoading(false);\n  };\n\n  return (\n      <div className=\"App\">\n        <h2>Orbs Rewards Report Generator</h2>\n        <br />\n        <Container textAlign=\"left\">\n          <Segment textAlign=\"left\" secondary style={{ width: \"50vw\", margin: \"auto\" }}>\n            <Form loading={loading} onSubmit={handleSubmit} spellcheck=\"false\">\n              <Form.Select\n                  label=\"Network\"\n                  name=\"networkType\"\n                  options={networkOptions}\n                  defaultValue=\"1\"\n                  onChange={handleChange}\n              />\n              <Form.Select\n                  label=\"Report Type\"\n                  name=\"reportType\"\n                  options={periodOptions}\n                  defaultValue=\"604800\"\n                  onChange={handleChange}\n              />\n              <Form.Input\n                  label=\"Number Of Report Periods\"\n                  name=\"reportPeriods\"\n                  defaultValue=\"3\"\n                  onChange={handleChange}\n              />\n              <Form.Checkbox\n                  radio\n                  label=\"Show Only Full Periods\"\n                  name=\"reportShowFull\"\n                  value=\"true\"\n                  checked={input.reportShowFull === 'true'}\n                  onChange={handleChange}\n              />\n              <Form.Checkbox\n                  radio\n                  label=\"Show Last Partial Period\"\n                  name=\"reportShowFull\"\n                  value=\"false\"\n                  checked={input.reportShowFull === 'false'}\n                  onChange={handleChange}\n              />\n              <Form.Input\n                  label=\"File Name Prefix\"\n                  name=\"reportFilenamePrefix\"\n                  defaultValue=\"report\"\n                  onChange={handleChange}\n              />\n              <Form.Button primary>Submit</Form.Button>\n            </Form>\n          </Segment>\n        </Container>\n      </div>\n  );\n}\n\nexport default App;\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"semantic-ui-css/semantic.min.css\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);"],"sourceRoot":""}