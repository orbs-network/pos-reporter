{"version":3,"sources":["report.js","xls.js","App.js","index.js"],"names":["DefaultPeriodBlocks","blockDuration","DefaultAbsoluteStartBlock","getStartOfRewardsBlock","DefaultExcluded","web3Mapping","getWeb3","getWeb3Polygon","getBlockByTimestamp","timestamp","chainId","a","apiUrl","fetch","response","json","status","alert","parseInt","result","getPeriodsReport","ethereumEndpoint","networkType","nodeEndpoints","ethNodeEndpoints","options","periods_start","interestingGuardians","calculateDelegators","excluded","exclude_guardians","_","getGuardians","g","includes","address","push","certified","forEach","getGuardiansPeriodsReport","guardianAddresses","isString","web3","generatePeriodDetails","reportDetails","participants","i","length","getGuardianPeriodsReport","guardianAddress","rewards","console","log","trimNonFullPeriodIfNeeded","details","generatePeriodsStart","eth","getBlock","maxEndBlock","periodsStart","periodLength","period_in_blocks","maxPeriods","periods","show_only_full_periods","number","currStart","block_info","block_ts","getChainId","txs","currEnd","totalLength","start","time","start_block","start_block_time","end_block","end_block_time","Promise","all","res","Number","number_of_periods","total_length_of_periods","start_of_periods_block","end_of_periods_block","report","readOptions","read_from_block","participantsRewards","getGuardian","gInfo","stack","sleep","generateGuardianPeriodResults","generateParticipantObject","allGuardianRewards","guardianSelfRewards","sumDelegatorRewards","generateAllDelegatorPaticipationRewads","guardian","guardianShareToTotal","reward_status","delegator_reward_share","guardianShareToAllDelegatorsShare","periodRewardsAsGuardian","generatePeriodReport","reward_as_guardian_slices","periodRewardsAsDelegator","reward_as_delegator_slices","periodDelegatorReward","map","v","guaridan","periodsData","periodRewards","currPeriod","currPeriodReward","isUndefined","guardian_from","block_number","total_awarded","deltaReward","deltaBlocks","neededDelta","generateTypedDelegatorPaticipationRewads","delegators","delegators_left","isHistoric","delegator","drewards","readRetryDelegator","getDelegatorStakingRewards","type","delegatorAddress","guardianName","name","guardianCertified","shift","ms","resolve","setTimeout","reportToXlsx","workbook","Workbook","worksheet","addWorksheet","views","state","ySplit","header2","header3","header4","totals","toDate","addRows","participant","row","addRow","totalsRow","getColumn","width","getRow","font","bold","j","getCell","value","border","top","style","right","numFmt","xlsx","writeBuffer","seconds","d","Date","toISOString","slice","providersEndpoints","providersNodesEndpoints","PeriodInBlocks","getReport","reportPeriodLength","reportNumberOfPeriods","reportShowOnlyFull","web3Eth","blockNumber","block","periodsStartEth","valueOf","joinReports","report1","report2","concat","foundMatch","p","num","idx","splice","downloadReport","reportFilenamePrefix","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","parentNode","removeChild","periodOptions","key","text","networkOptions","App","useState","reportType","reportPeriods","reportShowFull","input","setInput","loading","setLoading","handleChange","_e","handleSubmit","ethResult","polyResult","typesOrder","sort","b","indexOf","className","Container","textAlign","Segment","secondary","margin","Form","onSubmit","spellcheck","Select","label","defaultValue","onChange","Input","Checkbox","radio","checked","Button","primary","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.a8953d5f.chunk.js","sourcesContent":["/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport _  from 'lodash';\nimport { getDelegatorStakingRewards, getGuardian, getGuardians, getStartOfRewardsBlock, getWeb3, getWeb3Polygon } from \"@orbs-network/pos-analytics-lib\";\n\nconst DefaultPeriodBlocks = 604800;\nconst DefualtPeriods = 3;\nconst blockDuration = {1: 13, 137: 2}\nconst DefaultAbsoluteStartBlock = getStartOfRewardsBlock();\nconst DefaultExcluded = ['0x4aca0c63e351b2ea44ee628425710e933b5b3396', '0xca0ff0479bd7f52e55e65da7b76074b477b734b3'];\nconst web3Mapping = {'ethereum': getWeb3, 'polygon': getWeb3Polygon}\nexport {getWeb3};\n\nasync function getBlockByTimestamp(timestamp, chainId) {\n    const apiUrl = chainId === 137 ? `https://api.polygonscan.com/api?module=block&action=getblocknobytime&timestamp=${timestamp}&closest=before&apikey=BEVY6JKW1VTU634UWBE2FZYKN3EDB3RZSR` :\n        `https://api.etherscan.io/api?module=block&action=getblocknobytime&closest=before&timestamp=${timestamp}&apikey=3U9E3HF8WYHXHCHNPP8E3AP8V7H2V8XU4T`\n    const response = await fetch(apiUrl);\n    const json = await response.json();\n    if (json.status !== '1') {\n        alert(\"An error occurred. Please try again\")\n    }\n    return parseInt(json.result);\n}\n\nexport async function getPeriodsReport(ethereumEndpoint, networkType, nodeEndpoints, ethNodeEndpoints, options, periods_start) {\n    const interestingGuardians = [];\n    const calculateDelegators = [];\n    const excluded = options.exclude_guardians || DefaultExcluded;\n    _.forEach(await getGuardians(nodeEndpoints, ethNodeEndpoints), g => {\n        if (!excluded.includes(g.address)) {\n            interestingGuardians.push(g.address);\n            calculateDelegators.push(!g.certified);\n        }\n    });\n\n    return getGuardiansPeriodsReport(interestingGuardians, networkType, calculateDelegators, ethereumEndpoint, options, periods_start);\n}\n\nexport async function getGuardiansPeriodsReport(guardianAddresses, networkType, calculateDelegators, ethereumEndpoint, options, periods_start) {\n    const web3 = _.isString(ethereumEndpoint) ? await web3Mapping[networkType](ethereumEndpoint) : ethereumEndpoint;\n\n    const reportDetails = await generatePeriodDetails(options, web3, periods_start);\n    const participants = [];\n\n    for (let i = 0;i < guardianAddresses.length;i++) {\n        try {\n             participants.push(...(await getGuardianPeriodsReport(guardianAddresses[i], calculateDelegators[i], web3, reportDetails)));\n        } catch (e) {\n            participants.push({guardianAddress: guardianAddresses[i], rewards: []});\n            console.log(`Error while generating guardian ${guardianAddresses[i]}: ${e} ... (skipped)`);\n        }\n    }\n\n    trimNonFullPeriodIfNeeded(reportDetails, participants, options);\n    \n    return {\n        details: reportDetails,\n        participants\n    }\n}\n\nexport async function generatePeriodsStart(options, web3) {\n    const maxEndBlock = await web3.eth.getBlock('latest');\n    const periodsStart = [];\n    const periodLength = options.period_in_blocks || DefaultPeriodBlocks;\n    const maxPeriods = (options.periods || DefualtPeriods) + (options.show_only_full_periods === true ? 1 : 0);\n\n    let currEnd = maxEndBlock.number;\n    let currStart = (maxEndBlock.number - periodLength + 1) > DefaultAbsoluteStartBlock.number\n        ? maxEndBlock.number - ((maxEndBlock.number - DefaultAbsoluteStartBlock.number) % periodLength)\n        : DefaultAbsoluteStartBlock.number;\n    do {\n        const block_info = await web3.eth.getBlock(currStart);\n        const block_ts = block_info.timestamp;\n        periodsStart.push({'number': currStart, 'time': block_ts});\n        currEnd = currStart - 1;\n        currStart = currEnd - periodLength + 1;\n    } while (periodsStart.length < maxPeriods && currStart >= DefaultAbsoluteStartBlock.number)\n    return periodsStart;\n}\n\n\n// Generate full periods + partial (data always starts from )\nasync function generatePeriodDetails(options, web3, periods_start) {\n    const maxEndBlock = await web3.eth.getBlock('latest');\n    const periods = []; \n    const periodLength = options.period_in_blocks || DefaultPeriodBlocks;\n    const chainId = await web3.eth.getChainId();\n\n    const txs = [];\n    let currEnd = maxEndBlock.number;\n    let totalLength = 0;\n\n    for (let start of periods_start) {\n        let currStart = chainId === 137 ? await getBlockByTimestamp(start.time, chainId) : start.number;\n        periods.push({\n            start_block: currStart,\n            start_block_time: 0,\n            end_block: currEnd,\n            end_block_time: 0,\n            length: currEnd-currStart+1\n        });\n        totalLength += (currEnd-currStart+1);\n        txs.push(web3.eth.getBlock(currStart));\n        currEnd = currStart - 1;\n        currStart = currEnd - periodLength + 1;\n    }\n\n    const res = await Promise.all(txs);\n    for(let i = 0;i < periods.length;i++) {\n        periods[i].end_block_time = Number(i === 0 ? maxEndBlock.timestamp : res[i-1].timestamp - blockDuration[chainId]);\n        periods[i].start_block_time = Number(res[i].timestamp);\n    }\n \n    return {\n        number_of_periods: periods.length,\n        total_length_of_periods: totalLength,\n        start_of_periods_block: periods[periods.length-1].start_block,\n        end_of_periods_block: periods[0].end_block, \n        periods,\n    }\n}\n\nasync function getGuardianPeriodsReport(address, calculateDelegators, web3, report) {\n    const readOptions = {\n        read_from_block: report.start_of_periods_block - 10000, /* need cushion for event to have before first block */\n    }\n    const participantsRewards = [];\n\n    let gInfo;\n    try {\n        gInfo = await getGuardian(address, web3, readOptions);\n    } catch (e) {\n        console.log(`Error while generating guardian ${address}: ${e.stack} ... (going to retry now)`);\n        sleep(1000); // just in case\n        gInfo = await getGuardian(address, web3, readOptions);\n    }\n    gInfo.details.certified = !calculateDelegators; // set the certified info calculated based on eth network\n    const res = generateGuardianPeriodResults(gInfo, report.periods);\n    participantsRewards.push(generateParticipantObject(gInfo, 'Total', res.allGuardianRewards));\n    participantsRewards.push(generateParticipantObject(gInfo, 'Self-Share (guardian + self-delegate)', res.guardianSelfRewards));\n    participantsRewards.push(generateParticipantObject(gInfo, 'Total Delegators', res.sumDelegatorRewards));\n\n    if (calculateDelegators) {\n        await generateAllDelegatorPaticipationRewads(gInfo, web3, readOptions, report.periods, participantsRewards);\n    }\n\n    return participantsRewards;\n}\n\nfunction generateGuardianPeriodResults(guardian, periods) {\n    const guardianShareToTotal = 1.0 / (1.0-guardian.reward_status.delegator_reward_share);\n    const guardianShareToAllDelegatorsShare = guardian.reward_status.delegator_reward_share / (1-guardian.reward_status.delegator_reward_share);\n\n    const periodRewardsAsGuardian = generatePeriodReport(guardian.reward_as_guardian_slices, guardian.address, periods);\n    const periodRewardsAsDelegator = generatePeriodReport(guardian.reward_as_delegator_slices, guardian.address, periods);\n    const guardianSelfRewards = [], sumDelegatorRewards = [];\n    for(let i = 0;i < periodRewardsAsGuardian.length;i++) {\n        const periodDelegatorReward = i < periodRewardsAsDelegator.length ? periodRewardsAsDelegator[i] : 0\n        guardianSelfRewards.push(periodRewardsAsGuardian[i] + periodDelegatorReward);\n        sumDelegatorRewards.push(periodRewardsAsGuardian[i] * guardianShareToAllDelegatorsShare - periodDelegatorReward);\n    }\n\n    return { \n        allGuardianRewards: _.map(periodRewardsAsGuardian, v => v * guardianShareToTotal),\n        sumDelegatorRewards, \n        guardianSelfRewards\n    };\n}\n\n// Assumptions:\n// 1. eigher the last reward is begining of time or there are more than needed.\n// 2. for delegators an assignreward event happends when change of delegation.\nfunction generatePeriodReport(rewards, guaridan, periodsData) {\n    const periodRewards = [];\n    let currPeriod = 0;\n    let currPeriodReward = 0;\n    for (let i = 0;currPeriod < periodsData.length && i < rewards.length-1;i++) {\n        if (_.isUndefined(rewards[i].guardian_from) || rewards[i].guardian_from === guaridan) { // count this delta\n            if (rewards[i+1].block_number >= periodsData[currPeriod].start_block) { // full 'delta' counted\n                currPeriodReward += rewards[i].total_awarded - rewards[i+1].total_awarded;\n            } else { // partial 'delta' counted \n                const deltaReward = rewards[i].total_awarded - rewards[i+1].total_awarded;\n                const deltaBlocks = rewards[i].block_number - rewards[i+1].block_number;\n                const neededDeltaBlocks = rewards[i].block_number - periodsData[currPeriod].start_block + 1;\n                const neededDelta = deltaReward * neededDeltaBlocks / deltaBlocks\n                currPeriodReward += neededDelta;\n                periodRewards.push(currPeriodReward);\n   \n                currPeriodReward = deltaReward - neededDelta;\n                currPeriod++;            \n            }\n        } else if (rewards[i+1].block_number <= periodsData[currPeriod].start_block) { // just check if next period\n            periodRewards.push(currPeriodReward);\n            currPeriodReward = 0;\n            currPeriod++;            \n        } \n    }\n    if (currPeriod < periodsData.length) {\n        periodRewards.push(currPeriodReward);\n    }\n\n    for (let i=periodRewards.length; i<periodsData.length; i++) {  // patch: fill missing periods with 0s\n        periodRewards.push(0);\n    }\n\n    return periodRewards;\n}\n\nasync function generateAllDelegatorPaticipationRewads(guardian, web3, options, periods, participantsRewards) {\n    await generateTypedDelegatorPaticipationRewads(guardian, guardian.delegators, false, web3, options, periods, participantsRewards);\n    await generateTypedDelegatorPaticipationRewads(guardian, guardian.delegators_left, true, web3, options, periods, participantsRewards);\n}\n\nasync function generateTypedDelegatorPaticipationRewads(guardian, delegators, isHistoric, web3, options, periods, participantsRewards) {\n    for (const delegator of delegators) {\n        let drewards = []\n        try {\n            drewards = generatePeriodReport(await readRetryDelegator(delegator.address, web3, options), guardian.address, periods);\n        } catch (e) {\n            console.log(`Error while generating ${isHistoric ? \"historical\" : \"\" } delegator ${delegator.address}: ${e.stack} ... (skipped)`);\n        }\n        participantsRewards.push(generateParticipantObject(guardian, isHistoric ? 'Historical Delegator': 'Delegator', drewards, delegator.address));\n    }\n}\n\nasync function readRetryDelegator(address, web3, options) {\n    try {\n        return (await getDelegatorStakingRewards(address, web3, options)).rewards;\n    } catch (e) {\n        console.log(`Error while generating delegator ${address}: ${e.stack} ... (going to retry now)`);\n        sleep(1000); // just in case\n        return (await getDelegatorStakingRewards(address, web3, options)).rewards;\n    }\n}\n\nfunction generateParticipantObject(guardian, type, rewards, delegatorAddress) {\n    return {\n        guardianAddress: guardian.address,\n        guardianName: guardian.details.name,\n        guardianCertified: guardian.details.certified,\n        type,\n        delegatorAddress,\n        rewards\n    };\n}\n\nfunction trimNonFullPeriodIfNeeded(details, participants, options) {\n    const periodLength = options.period_in_blocks || DefaultPeriodBlocks;\n    if (details.periods.length > 1 && details.periods[0].length < periodLength && options.show_only_full_periods === true) {\n        details.total_length_of_periods = details.total_length_of_periods - details.periods[0].length;\n        details.periods.shift();\n        details.number_of_periods = details.number_of_periods - 1;\n        details.end_of_periods_block = details.periods[0].end_block;\n        for (const participant of participants) {\n            participant.rewards.shift();\n        }\n    }\n}\n\nfunction sleep(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter library in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport {Workbook} from 'exceljs';\n\nexport async function reportToXlsx(report) {\n    const workbook = new Workbook();  \n    const worksheet = workbook.addWorksheet('Report', {views:[{state: 'frozen', ySplit: 3}]});  \n    \n    // headers\n    const header2 = ['','','','',''], header3 = ['','','','',''], header4 = ['Guardian Address','Guardian Name', 'Certified', 'Type', 'Delegaor Address'];\n    const totals = [];\n    for(let i = report.details.number_of_periods-1;i >= 0;i--) {\n        header2.push(`${toDate(report.details.periods[i].start_block_time)} to ${toDate(report.details.periods[i].end_block_time)} GMT`);\n        header3.push(`${report.details.periods[i].start_block} to ${report.details.periods[i].end_block} (${report.details.periods[i].length} blocks)`)\n        header4.push('Distributed (ORBS)');\n        totals.push(0);\n    }\n    worksheet.addRows([header2, header3, header4]);\n\n    // data\n    for (const participant of report.participants) {\n        const row = [\n            participant.guardianAddress, participant.guardianName, participant.guardianCertified, \n            participant.type, participant.delegatorAddress || ''\n        ];\n        if (participant.rewards.length === 0) {\n            row.push('Missing Data');\n        } else { \n            for(let i = participant.rewards.length;i < report.details.number_of_periods;i++) {\n                row.push(0);\n            }\n            for (let i = participant.rewards.length-1;i >=0;i--) {\n                row.push(participant.rewards[i]);\n                if (participant.type === 'Total') { // notice the reverse order :)\n                    totals[report.details.number_of_periods-1-i] = totals[report.details.number_of_periods-1-i] + participant.rewards[i];\n                }\n            }\n        }\n        worksheet.addRow(row);\n    }\n    //worksheet.getCell('A3').value = { formula: 'A1+A2', result: 7 };\n    const totalsRow = worksheet.addRow(['','','','','Total Distributed:', ...totals]);\n    \n    // formatting\n    worksheet.getColumn(1).width = 42;\n    worksheet.getColumn(2).width = 35;\n    worksheet.getColumn(3).width = 8;\n    worksheet.getColumn(4).width = 35;\n    worksheet.getColumn(5).width = 42;\n    for(let i = 0;i < report.details.number_of_periods;i++) {\n        worksheet.getColumn(6+i).width = 40;  \n    }\n    worksheet.getRow(3).font = {bold: true};\n    for(let j=4;j < 4+report.participants.length;j++) {\n        const row = worksheet.getRow(j);\n        if (row.getCell(4).value === 'Total') {\n            row.font = {bold: true};\n            row.border = {top: {style:'thin'}};\n            row.getCell(5).border = {top: {style:'thin'}, right: {style:'thin'}};\n        } else {\n            row.getCell(5).border = {right: {style:'thin'}};\n        }\n        for(let i = 6;i < 6 + report.details.number_of_periods;i++) {\n            row.getCell(i).numFmt = \"#,##0.00\";\n        }\n\n    }\n    totalsRow.font = {bold: true};\n    totalsRow.getCell(1).border = {top: {style:'thin'}};\n    totalsRow.getCell(2).border = {top: {style:'thin'}};\n    totalsRow.getCell(3).border = {top: {style:'thin'}};\n    totalsRow.getCell(4).border = {top: {style:'thin'}};\n    totalsRow.getCell(5).border = {top: {style:'thin'}, right: {style:'thin'}};\n    for(let i = 6;i < 6 + report.details.number_of_periods;i++) {\n         totalsRow.getCell(i).numFmt = \"#,##0.00\";\n         totalsRow.getCell(i).border = {top: {style:'double'}};\n    }\n    \n    return workbook.xlsx.writeBuffer()\n}\n\nfunction toDate(seconds) {\n    const d = new Date(seconds * 1000).toISOString();\n    return d.slice(0,10) + ' ' + d.slice(11,19);\n}\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport React, { useState } from \"react\";\nimport { Container, Segment, Form } from \"semantic-ui-react\";\nimport \"./App.css\";\n\nimport { getPeriodsReport, generatePeriodsStart, getWeb3 } from './report.js';\nimport { reportToXlsx } from './xls.js';\nconst providersEndpoints = {\n  'ethereum': 'https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9',\n  'polygon': 'https://polygon-mainnet.g.alchemy.com/v2/c93z5UqYd5bR2paVR7PtUXhkVEIDIex0'\n}\nconst providersNodesEndpoints = {\n  'ethereum': ['https://0xcore-management-direct.global.ssl.fastly.net/status'],\n  'polygon': ['https://0xcore-matic-reader-direct.global.ssl.fastly.net/status']\n}\nconst PeriodInBlocks = {\n  'Quarterly': {'ethereum': '604800', 'polygon': '3435449'},\n  'Monthly': {'ethereum': '199385', 'polygon': '1132565'},\n  'Weekly': {'ethereum': '46525', 'polygon': '264265'}\n}\nasync function getReport(reportPeriodLength, networkType, reportNumberOfPeriods, reportShowOnlyFull) {\n  const ethereumEndpoint = providersEndpoints[networkType];\n  const nodeEndpoints = providersNodesEndpoints[networkType];\n  const ethNodeEndpoints = providersNodesEndpoints['ethereum'];\n\n  const web3Eth = await getWeb3(providersEndpoints['ethereum']);\n  let periodsStartEth;\n  let options;\n\n  if (reportPeriodLength === \"Custom\") {\n    // 1 period. Start = reportNumberOfPeriods (\"From block\")\n    let blockNumber;\n    if (networkType === 'polygon') {\n      const web3 = await getWeb3(providersEndpoints['polygon']);\n      blockNumber = (await web3.eth.getBlock(\"latest\")).number;\n    } else {\n      blockNumber = (await web3Eth.eth.getBlock(\"latest\")).number;\n    }\n    const period_in_blocks = blockNumber - parseInt(reportNumberOfPeriods);\n    options = {\n      period_in_blocks: period_in_blocks,\n      periods: 1,\n      show_only_full_periods: reportShowOnlyFull === 'true'\n    };\n\n    const block = await web3Eth.eth.getBlock(reportNumberOfPeriods);\n    periodsStartEth = [{number: block.number, time: block.timestamp}];\n  }\n  else {\n    options = {\n      period_in_blocks: new Number(PeriodInBlocks[reportPeriodLength]['ethereum']).valueOf(),\n      periods: new Number(reportNumberOfPeriods).valueOf(),\n      show_only_full_periods: reportShowOnlyFull === 'true'\n    };\n    periodsStartEth = await generatePeriodsStart(options, web3Eth)\n    options.period_in_blocks = new Number(PeriodInBlocks[reportPeriodLength][networkType]).valueOf()\n  }\n  return await getPeriodsReport(ethereumEndpoint, networkType, nodeEndpoints, ethNodeEndpoints, options, periodsStartEth)\n}\n\nfunction joinReports(report1, report2) {\n  let result = {\n    details: report1.details,\n    participants: []\n  }\n\n  const participants = report1.participants.concat(report2.participants);\n\n  for (let i=0; i<participants.length-1; i++) {\n    let foundMatch = false;\n    for (let j=i+1; j<participants.length; j++) {\n      if ((participants[i].guardianAddress === participants[j].guardianAddress && participants[i].type === participants[j].type)\n          && (!['Delegator', 'Historical Delegator'].includes(participants[i].type) || (participants[i].delegatorAddress === participants[j].delegatorAddress))) {\n        // condition to match and sum up the rewards: same guardian and type. if type in ['Delegator', 'Historical Delegator'] then only sum the same delegator, otherwise add to result set\n        foundMatch = true;\n        let p = participants[i];\n        p.rewards = participants[i].rewards.map(function (num, idx) {\n          return num + participants[j].rewards[idx];\n        });\n        result.participants.push(p);\n        participants.splice(j, 1); // remove to prevent duplicates\n        break;\n      }\n    }\n    if (!foundMatch) result.participants.push(participants[i]);\n  }\n\n  return result;\n}\n\nfunction downloadReport(report, reportFilenamePrefix) {\n  const url = window.URL.createObjectURL(new Blob([report]));\n  const link = document.createElement('a');\n  link.href = url;\n  link.setAttribute('download', `${reportFilenamePrefix}.${new Date().toISOString()}.xlsx`);\n  link.setAttribute('type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n  document.body.appendChild(link);\n  link.click();\n  link.parentNode.removeChild(link);\n}\n\nconst periodOptions = [\n  {\n    key: 'Quarterly',\n    text: 'Quarterly (91 days)',\n    value: 'Quarterly'\n  },\n  {\n    key: 'Monthly',\n    text: 'Monthly (30 days)',\n    value: 'Monthly'\n  },\n  {\n    key: 'Weekly',\n    text: 'Weekly (7 days)',\n    value: 'Weekly'\n  },\n  {\n    key: 'Custom',\n    text: 'Custom (From block #)',\n    value: 'Custom'\n  }\n];\n\nconst networkOptions =[\n  {\n    key: 'All',\n    text: 'All',\n    value: 'all'\n  },\n  {\n    key: 'Ethereum',\n    text: 'Ethereum',\n    value: 'ethereum'\n  },\n  {\n    key: 'Polygon',\n    text: 'Polygon',\n    value: 'polygon'\n  }\n];\n\nfunction App() {\n  const [input, setInput] = useState({reportType: 'Quarterly', networkType: 'all', reportPeriods: '3', reportShowFull: 'false', reportFilenamePrefix: \"report\"});\n  const [loading, setLoading] = useState(false);\n  const handleChange = (_e, { name, value }) => setInput({ ...input, [name]: value });\n  const { reportType, networkType, reportPeriods, reportShowFull, reportFilenamePrefix } = input;\n  const handleSubmit = async () => {\n    setLoading(true);\n    let report = null;\n    if (networkType === 'all') {\n      const ethResult = await getReport(reportType, 'ethereum', reportPeriods, reportShowFull);\n      const polyResult = await getReport(reportType, 'polygon', reportPeriods, reportShowFull);\n      report = joinReports(ethResult, polyResult)\n    }\n    else {\n      report = await getReport(reportType, networkType, reportPeriods, reportShowFull);\n    }\n\n    // sort the results\n    const typesOrder = ['Total', 'Self-Share (guardian + self-delegate)', 'Total Delegators', 'Delegator', 'Historical Delegator'];\n    report.participants.sort((a, b) => {\n      if (a.guardianAddress === b.guardianAddress) return typesOrder.indexOf(a.type) - typesOrder.indexOf(b.type);\n      return a.guardianAddress > b.guardianAddress ? 1 : -1;\n    });\n\n    const result = await reportToXlsx(report)\n    downloadReport(result, reportFilenamePrefix);\n    setLoading(false);\n  };\n\n  return (\n      <div className=\"App\">\n        <h2>Orbs Rewards Report Generator</h2>\n        <br />\n        <Container textAlign=\"left\">\n          <Segment textAlign=\"left\" secondary style={{ width: \"50vw\", margin: \"auto\" }}>\n            <Form loading={loading} onSubmit={handleSubmit} spellcheck=\"false\">\n              <Form.Select\n                  label=\"Network\"\n                  name=\"networkType\"\n                  options={networkOptions}\n                  defaultValue=\"all\"\n                  onChange={handleChange}\n              />\n              <Form.Select\n                  label=\"Report Type\"\n                  name=\"reportType\"\n                  options={periodOptions}\n                  defaultValue=\"Quarterly\"\n                  onChange={handleChange}\n              />\n              <Form.Input\n                  label={reportType === 'Custom' ? 'From Block' : \"Number Of Report Periods\"}\n                  name=\"reportPeriods\"\n                  defaultValue=\"3\"\n                  onChange={handleChange}\n              />\n              <Form.Checkbox\n                  radio\n                  label=\"Show Only Full Periods\"\n                  name=\"reportShowFull\"\n                  value=\"true\"\n                  checked={input.reportShowFull === 'true'}\n                  onChange={handleChange}\n              />\n              <Form.Checkbox\n                  radio\n                  label=\"Show Last Partial Period\"\n                  name=\"reportShowFull\"\n                  value=\"false\"\n                  checked={input.reportShowFull === 'false'}\n                  onChange={handleChange}\n              />\n              <Form.Input\n                  label=\"File Name Prefix\"\n                  name=\"reportFilenamePrefix\"\n                  defaultValue=\"report\"\n                  onChange={handleChange}\n              />\n              <Form.Button primary>Submit</Form.Button>\n            </Form>\n          </Segment>\n        </Container>\n      </div>\n  );\n}\n\nexport default App;\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"semantic-ui-css/semantic.min.css\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);"],"sourceRoot":""}