(this.webpackJsonporbs=this.webpackJsonporbs||[]).push([[0],{321:function(e,t){},360:function(e,t,r){},362:function(e,t,r){},375:function(e,t){},399:function(e,t){},401:function(e,t){},478:function(e,t){},480:function(e,t){},489:function(e,t){},491:function(e,t){},516:function(e,t){},522:function(e,t){},535:function(e,t){},651:function(e,t){},652:function(e,t){},658:function(e,t,r){"use strict";r.r(t);var a=r(34),n=r(0),o=r.n(n),s=r(85),c=r.n(s),i=(r(359),r(360),r(20)),l=r.n(i),u=r(148),d=r(214),p=r(220),f=r(33),b=r(674),h=r(676),g=r(675),_=(r(362),r(338)),m=r(131),w=r(18),k=r.n(w),x=r(74),y=604800,v=Object(x.getStartOfRewardsBlock)(),j=["0x4aca0c63e351b2ea44ee628425710e933b5b3396","0xca0ff0479bd7f52e55e65da7b76074b477b734b3"];function O(e,t,r){return C.apply(this,arguments)}function C(){return(C=Object(f.a)(l.a.mark((function e(t,r,a){var n,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],o=[],s=a.exclude_guardians||j,e.t0=k.a,e.next=6,Object(x.getGuardians)(r);case 6:return e.t1=e.sent,e.t2=function(e){s.includes(e.address)||(n.push(e.address),o.push(!e.certified))},e.t0.forEach.call(e.t0,e.t1,e.t2),e.abrupt("return",S(n,o,t,a));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,r,a){return R.apply(this,arguments)}function R(){return(R=Object(f.a)(l.a.mark((function e(t,r,a,n){var o,s,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.a.isString(a)){e.next=6;break}return e.next=3,Object(x.getWeb3)(a);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=a;case 7:return o=e.t0,e.next=10,D(n,o);case 10:s=e.sent,c=[],i=0;case 13:if(!(i<t.length)){e.next=32;break}return e.prev=14,e.t1=c.push,e.t2=c,e.t3=_.a,e.next=20,P(t[i],r[i],o,s);case 20:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5),e.next=29;break;case 25:e.prev=25,e.t6=e.catch(14),c.push({guardianAddress:t[i],rewards:[]}),console.log("Error while generating guardian ".concat(t[i],": ").concat(e.t6," ... (skipped)"));case 29:i++,e.next=13;break;case 32:return U(s,c,n),e.abrupt("return",{details:s,participants:c});case 34:case"end":return e.stop()}}),e,null,[[14,25]])})))).apply(this,arguments)}function D(e,t){return F.apply(this,arguments)}function F(){return(F=Object(f.a)(l.a.mark((function e(t,r){var a,n,o,s,c,i,u,d,p,f;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.eth.getBlock("latest");case 2:a=e.sent,n=[],o=t.period_in_blocks||y,s=(t.periods||3)+(!0===t.show_only_full_periods?1:0),c=[],i=a.number,u=a.number-o+1>v.number?a.number-(a.number-v.number)%o:v.number,d=0;do{n.push({start_block:u,start_block_time:0,end_block:i,end_block_time:0,length:i-u+1}),d+=i-u+1,c.push(r.eth.getBlock(u)),u=(i=u-1)-o+1}while(n.length<s&&u>=v.number);return e.next=13,Promise.all(c);case 13:for(p=e.sent,f=0;f<n.length;f++)n[f].end_block_time=Number(0===f?a.timestamp:p[f-1].timestamp-13),n[f].start_block_time=Number(p[f].timestamp);return e.abrupt("return",{number_of_periods:n.length,total_length_of_periods:d,start_of_periods_block:n[n.length-1].start_block,end_of_periods_block:n[0].end_block,periods:n});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,r,a){return A.apply(this,arguments)}function A(){return(A=Object(f.a)(l.a.mark((function e(t,r,a,n){var o,s,c,i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={read_from_block:n.start_of_periods_block-1e4},s=[],e.prev=2,e.next=5,Object(x.getGuardian)(t,a,o);case 5:c=e.sent,e.next=15;break;case 8:return e.prev=8,e.t0=e.catch(2),console.log("Error while generating guardian ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),V(1e3),e.next=14,Object(x.getGuardian)(t,a,o);case 14:c=e.sent;case 15:if(i=T(c,n.periods),s.push(L(c,"Total",i.allGuardianRewards)),s.push(L(c,"Self-Share (guardian + self-delegate)",i.guardianSelfRewards)),s.push(L(c,"Total Delegators",i.sumDelegatorRewards)),!r){e.next=22;break}return e.next=22,G(c,a,o,n.periods,s);case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function T(e,t){for(var r=1/(1-e.reward_status.delegator_reward_share),a=e.reward_status.delegator_reward_share/(1-e.reward_status.delegator_reward_share),n=N(e.reward_as_guardian_slices,e.address,t),o=N(e.reward_as_delegator_slices,e.address,t),s=[],c=[],i=0;i<n.length;i++){var l=i<o.length?o[i]:0;s.push(n[i]+l),c.push(n[i]*a-l)}return{allGuardianRewards:k.a.map(n,(function(e){return e*r})),sumDelegatorRewards:c,guardianSelfRewards:s}}function N(e,t,r){for(var a=[],n=0,o=0,s=0;n<r.length&&s<e.length-1;s++)if(k.a.isUndefined(e[s].guardian_from)||e[s].guardian_from===t)if(e[s+1].block_number>=r[n].start_block)o+=e[s].total_awarded-e[s+1].total_awarded;else{var c=e[s].total_awarded-e[s+1].total_awarded,i=e[s].block_number-e[s+1].block_number,l=c*(e[s].block_number-r[n].start_block+1)/i;o+=l,a.push(o),o=c-l,n++}else e[s+1].block_number<=r[n].start_block&&(a.push(o),o=0,n++);return n<r.length&&a.push(o),a}function G(e,t,r,a,n){return B.apply(this,arguments)}function B(){return(B=Object(f.a)(l.a.mark((function e(t,r,a,n,o){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t,t.delegators,!1,r,a,n,o);case 2:return e.next=4,E(t,t.delegators_left,!0,r,a,n,o);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,r,a,n,o,s){return I.apply(this,arguments)}function I(){return(I=Object(f.a)(l.a.mark((function e(t,r,a,n,o,s,c){var i,u,d,p;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(m.a)(r),e.prev=1,i.s();case 3:if((u=i.n()).done){e.next=22;break}return d=u.value,p=[],e.prev=6,e.t0=N,e.next=10,M(d.address,n,o);case 10:e.t1=e.sent,e.t2=t.address,e.t3=s,p=(0,e.t0)(e.t1,e.t2,e.t3),e.next=19;break;case 16:e.prev=16,e.t4=e.catch(6),console.log("Error while generating ".concat(a?"historical":""," delegator ").concat(d.address,": ").concat(e.t4.stack," ... (skipped)"));case 19:c.push(L(t,a?"Historical Delegator":"Delegator",p,d.address));case 20:e.next=3;break;case 22:e.next=27;break;case 24:e.prev=24,e.t5=e.catch(1),i.e(e.t5);case 27:return e.prev=27,i.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[1,24,27,30],[6,16]])})))).apply(this,arguments)}function M(e,t,r){return W.apply(this,arguments)}function W(){return(W=Object(f.a)(l.a.mark((function e(t,r,a){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(x.getDelegatorStakingRewards)(t,r,a);case 3:return e.abrupt("return",e.sent.rewards);case 6:return e.prev=6,e.t0=e.catch(0),console.log("Error while generating delegator ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),V(1e3),e.next=12,Object(x.getDelegatorStakingRewards)(t,r,a);case 12:return e.abrupt("return",e.sent.rewards);case 13:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function L(e,t,r,a){return{guardianAddress:e.address,guardianName:e.details.name,guardianCertified:e.details.certified,type:t,delegatorAddress:a,rewards:r}}function U(e,t,r){var a=r.period_in_blocks||y;if(e.periods.length>1&&e.periods[0].length<a&&!0===r.show_only_full_periods){e.total_length_of_periods=e.total_length_of_periods-e.periods[0].length,e.periods.shift(),e.number_of_periods=e.number_of_periods-1,e.end_of_periods_block=e.periods[0].end_block;var n,o=Object(m.a)(t);try{for(o.s();!(n=o.n()).done;){n.value.rewards.shift()}}catch(s){o.e(s)}finally{o.f()}}}function V(e){return new Promise((function(t){return setTimeout(t,e)}))}var J=r(335);function Q(e){return z.apply(this,arguments)}function z(){return(z=Object(f.a)(l.a.mark((function e(t){var r,a,n,o,s,c,i,u,d,p,f,b,h,g,_,w,k,x,y;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=new J.Workbook,a=r.addWorksheet("Report",{views:[{state:"frozen",ySplit:3}]}),n=["","","","",""],o=["","","","",""],s=["Guardian Address","Guardian Name","Certified","Type","Delegaor Address"],c=[],i=t.details.number_of_periods-1;i>=0;i--)n.push("".concat(H(t.details.periods[i].start_block_time)," to ").concat(H(t.details.periods[i].end_block_time)," GMT")),o.push("".concat(t.details.periods[i].start_block," to ").concat(t.details.periods[i].end_block," (").concat(t.details.periods[i].length," blocks)")),s.push("Distributed (ORBS)"),c.push(0);a.addRows([n,o,s]),u=Object(m.a)(t.participants);try{for(u.s();!(d=u.n()).done;){if(p=d.value,f=[p.guardianAddress,p.guardianName,p.guardianCertified,p.type,p.delegatorAddress||""],0===p.rewards.length)f.push("Missing Data");else{for(b=p.rewards.length;b<t.details.number_of_periods;b++)f.push(0);for(h=p.rewards.length-1;h>=0;h--)f.push(p.rewards[h]),"Total"===p.type&&(c[t.details.number_of_periods-1-h]=c[t.details.number_of_periods-1-h]+p.rewards[h])}a.addRow(f)}}catch(l){u.e(l)}finally{u.f()}for(g=a.addRow(["","","","","Total Distributed:"].concat(c)),a.getColumn(1).width=42,a.getColumn(2).width=35,a.getColumn(3).width=8,a.getColumn(4).width=35,a.getColumn(5).width=42,_=0;_<t.details.number_of_periods;_++)a.getColumn(6+_).width=40;for(a.getRow(3).font={bold:!0},w=4;w<4+t.participants.length;w++)for("Total"===(k=a.getRow(w)).getCell(4).value?(k.font={bold:!0},k.border={top:{style:"thin"}},k.getCell(5).border={top:{style:"thin"},right:{style:"thin"}}):k.getCell(5).border={right:{style:"thin"}},x=6;x<6+t.details.number_of_periods;x++)k.getCell(x).numFmt="#,##0.00";for(g.font={bold:!0},g.getCell(1).border={top:{style:"thin"}},g.getCell(2).border={top:{style:"thin"}},g.getCell(3).border={top:{style:"thin"}},g.getCell(4).border={top:{style:"thin"}},g.getCell(5).border={top:{style:"thin"},right:{style:"thin"}},y=6;y<6+t.details.number_of_periods;y++)g.getCell(y).numFmt="#,##0.00",g.getCell(y).border={top:{style:"double"}};return e.abrupt("return",r.xlsx.writeBuffer());case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){var t=new Date(1e3*e).toISOString();return t.slice(0,10)+" "+t.slice(11,19)}function q(e,t,r){return K.apply(this,arguments)}function K(){return(K=Object(f.a)(l.a.mark((function e(t,r,a){var n,o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9",n=["https://0xcore-management-direct.global.ssl.fastly.net/status"],o={period_in_blocks:new Number(t).valueOf(),periods:new Number(r).valueOf(),show_only_full_periods:"true"===a},e.next=5,O("https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9",n,o);case 5:return s=e.sent,e.abrupt("return",Q(s));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e,t){var r=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.href=r,a.setAttribute("download","".concat(t,".").concat((new Date).toISOString(),".xlsx")),a.setAttribute("type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a)}var Y=[{key:"Quarterly",text:"Quarterly (91 days)",value:"604800"},{key:"Monthly",text:"Monthly (30 days)",value:"199385"},{key:"Weekly",text:"Weekly (7 days)",value:"46525"}];var Z=function(){var e=Object(n.useState)({reportType:"604800",reportPeriods:"3",reportShowFull:"false",reportFilenamePrefix:"report"}),t=Object(p.a)(e,2),r=t[0],o=t[1],s=Object(n.useState)(!1),c=Object(p.a)(s,2),i=c[0],_=c[1],m=function(e,t){var a=t.name,n=t.value;return o(Object(d.a)(Object(d.a)({},r),{},Object(u.a)({},a,n)))},w=function(){var e=Object(f.a)(l.a.mark((function e(){var t,a,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.reportType,a=r.reportPeriods,n=r.reportShowFull,o=r.reportFilenamePrefix,_(!0),e.next=4,q(t,a,n);case 4:X(e.sent,o),_(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("h2",{children:"Orbs Rewards Report Generator"}),Object(a.jsx)("br",{}),Object(a.jsx)(b.a,{textAlign:"left",children:Object(a.jsx)(h.a,{textAlign:"left",secondary:!0,style:{width:"50vw",margin:"auto"},children:Object(a.jsxs)(g.a,{loading:i,onSubmit:w,spellcheck:"false",children:[Object(a.jsx)(g.a.Select,{label:"Report Type",name:"reportType",options:Y,defaultValue:"604800",onChange:m}),Object(a.jsx)(g.a.Input,{label:"Number Of Report Periods",name:"reportPeriods",defaultValue:"3",onChange:m}),Object(a.jsx)(g.a.Checkbox,{radio:!0,label:"Show Only Full Periods",name:"reportShowFull",value:"true",checked:"true"===r.reportShowFull,onChange:m}),Object(a.jsx)(g.a.Checkbox,{radio:!0,label:"Show Last Partial Period",name:"reportShowFull",value:"false",checked:"false"===r.reportShowFull,onChange:m}),Object(a.jsx)(g.a.Input,{label:"File Name Prefix",name:"reportFilenamePrefix",defaultValue:"report",onChange:m}),Object(a.jsx)(g.a.Button,{primary:!0,children:"Submit"})]})})})]})};c.a.render(Object(a.jsx)(o.a.StrictMode,{children:Object(a.jsx)(Z,{})}),document.getElementById("root"))}},[[658,1,2]]]);
//# sourceMappingURL=main.fccef8d1.chunk.js.map