(this.webpackJsonporbs=this.webpackJsonporbs||[]).push([[0],{332:function(e,t){},372:function(e,t,r){},374:function(e,t,r){},389:function(e,t){},391:function(e,t){},396:function(e,t){},397:function(e,t){},424:function(e,t){},426:function(e,t){},440:function(e,t){},442:function(e,t){},457:function(e,t){},475:function(e,t){},477:function(e,t){},495:function(e,t){},496:function(e,t){},564:function(e,t){},566:function(e,t){},572:function(e,t){},584:function(e,t){},587:function(e,t){},592:function(e,t){},671:function(e,t){},708:function(e,t){},709:function(e,t){},716:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),o=r(93),s=r.n(o),c=(r(371),r(372),r(155)),i=r(224),l=r(229),u=r(35),d=r(20),p=r.n(d),f=r(732),b=r(734),h=r(733),g=(r(374),r(351)),m=r(135),_=r(18),w=r.n(_),k=r(62),y=604800,x=Object(k.getStartOfRewardsBlock)(),v=["0x4aca0c63e351b2ea44ee628425710e933b5b3396","0xca0ff0479bd7f52e55e65da7b76074b477b734b3"],j={1:k.getWeb3,137:k.getWeb3Polygon};function O(e,t,r,n){return C.apply(this,arguments)}function C(){return(C=Object(u.a)(p.a.mark((function e(t,r,n,a){var o,s,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],s=[],c=a.exclude_guardians||v,e.t0=w.a,e.next=6,Object(k.getGuardians)(n);case 6:return e.t1=e.sent,e.t2=function(e){c.includes(e.address)||(o.push(e.address),s.push(!e.certified))},e.t0.forEach.call(e.t0,e.t1,e.t2),e.abrupt("return",S(o,r,s,t,a));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,r,n,a){return R.apply(this,arguments)}function R(){return(R=Object(u.a)(p.a.mark((function e(t,r,n,a,o){var s,c,i,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w.a.isString(a)){e.next=6;break}return e.next=3,j[r](a);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=a;case 7:return s=e.t0,e.next=10,P(o,s);case 10:c=e.sent,i=[],l=0;case 13:if(!(l<t.length)){e.next=32;break}return e.prev=14,e.t1=i.push,e.t2=i,e.t3=g.a,e.next=20,D(t[l],n[l],s,c);case 20:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5),e.next=29;break;case 25:e.prev=25,e.t6=e.catch(14),i.push({guardianAddress:t[l],rewards:[]}),console.log("Error while generating guardian ".concat(t[l],": ").concat(e.t6," ... (skipped)"));case 29:l++,e.next=13;break;case 32:return U(c,i,o),e.abrupt("return",{details:c,participants:i});case 34:case"end":return e.stop()}}),e,null,[[14,25]])})))).apply(this,arguments)}function P(e,t){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(p.a.mark((function e(t,r){var n,a,o,s,c,i,l,u,d,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.eth.getBlock("latest");case 2:n=e.sent,a=[],o=t.period_in_blocks||y,s=(t.periods||3)+(!0===t.show_only_full_periods?1:0),c=[],i=n.number,l=n.number-o+1>x.number?n.number-(n.number-x.number)%o:x.number,u=0;do{a.push({start_block:l,start_block_time:0,end_block:i,end_block_time:0,length:i-l+1}),u+=i-l+1,c.push(r.eth.getBlock(l)),l=(i=l-1)-o+1}while(a.length<s&&l>=x.number);return e.next=13,Promise.all(c);case 13:for(d=e.sent,f=0;f<a.length;f++)a[f].end_block_time=Number(0===f?n.timestamp:d[f-1].timestamp-13),a[f].start_block_time=Number(d[f].timestamp);return e.abrupt("return",{number_of_periods:a.length,total_length_of_periods:u,start_of_periods_block:a[a.length-1].start_block,end_of_periods_block:a[0].end_block,periods:a});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,r,n){return F.apply(this,arguments)}function F(){return(F=Object(u.a)(p.a.mark((function e(t,r,n,a){var o,s,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={read_from_block:a.start_of_periods_block-1e4},s=[],e.prev=2,e.next=5,Object(k.getGuardian)(t,n,o);case 5:c=e.sent,e.next=15;break;case 8:return e.prev=8,e.t0=e.catch(2),console.log("Error while generating guardian ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),L(1e3),e.next=14,Object(k.getGuardian)(t,n,o);case 14:c=e.sent;case 15:if(i=A(c,a.periods),s.push(M(c,"Total",i.allGuardianRewards)),s.push(M(c,"Self-Share (guardian + self-delegate)",i.guardianSelfRewards)),s.push(M(c,"Total Delegators",i.sumDelegatorRewards)),!r){e.next=22;break}return e.next=22,E(c,n,o,a.periods,s);case 22:return e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function A(e,t){for(var r=1/(1-e.reward_status.delegator_reward_share),n=e.reward_status.delegator_reward_share/(1-e.reward_status.delegator_reward_share),a=N(e.reward_as_guardian_slices,e.address,t),o=N(e.reward_as_delegator_slices,e.address,t),s=[],c=[],i=0;i<a.length;i++){var l=i<o.length?o[i]:0;s.push(a[i]+l),c.push(a[i]*n-l)}return{allGuardianRewards:w.a.map(a,(function(e){return e*r})),sumDelegatorRewards:c,guardianSelfRewards:s}}function N(e,t,r){for(var n=[],a=0,o=0,s=0;a<r.length&&s<e.length-1;s++)if(w.a.isUndefined(e[s].guardian_from)||e[s].guardian_from===t)if(e[s+1].block_number>=r[a].start_block)o+=e[s].total_awarded-e[s+1].total_awarded;else{var c=e[s].total_awarded-e[s+1].total_awarded,i=e[s].block_number-e[s+1].block_number,l=c*(e[s].block_number-r[a].start_block+1)/i;o+=l,n.push(o),o=c-l,a++}else e[s+1].block_number<=r[a].start_block&&(n.push(o),o=0,a++);return a<r.length&&n.push(o),n}function E(e,t,r,n,a){return G.apply(this,arguments)}function G(){return(G=Object(u.a)(p.a.mark((function e(t,r,n,a,o){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,t.delegators,!1,r,n,a,o);case 2:return e.next=4,B(t,t.delegators_left,!0,r,n,a,o);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t,r,n,a,o,s){return I.apply(this,arguments)}function I(){return(I=Object(u.a)(p.a.mark((function e(t,r,n,a,o,s,c){var i,l,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(m.a)(r),e.prev=1,i.s();case 3:if((l=i.n()).done){e.next=22;break}return u=l.value,d=[],e.prev=6,e.t0=N,e.next=10,V(u.address,a,o);case 10:e.t1=e.sent,e.t2=t.address,e.t3=s,d=(0,e.t0)(e.t1,e.t2,e.t3),e.next=19;break;case 16:e.prev=16,e.t4=e.catch(6),console.log("Error while generating ".concat(n?"historical":""," delegator ").concat(u.address,": ").concat(e.t4.stack," ... (skipped)"));case 19:c.push(M(t,n?"Historical Delegator":"Delegator",d,u.address));case 20:e.next=3;break;case 22:e.next=27;break;case 24:e.prev=24,e.t5=e.catch(1),i.e(e.t5);case 27:return e.prev=27,i.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[1,24,27,30],[6,16]])})))).apply(this,arguments)}function V(e,t,r){return W.apply(this,arguments)}function W(){return(W=Object(u.a)(p.a.mark((function e(t,r,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(k.getDelegatorStakingRewards)(t,r,n);case 3:case 12:return e.abrupt("return",e.sent.rewards);case 6:return e.prev=6,e.t0=e.catch(0),console.log("Error while generating delegator ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),L(1e3),e.next=12,Object(k.getDelegatorStakingRewards)(t,r,n);case 13:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function M(e,t,r,n){return{guardianAddress:e.address,guardianName:e.details.name,guardianCertified:e.details.certified,type:t,delegatorAddress:n,rewards:r}}function U(e,t,r){var n=r.period_in_blocks||y;if(e.periods.length>1&&e.periods[0].length<n&&!0===r.show_only_full_periods){e.total_length_of_periods=e.total_length_of_periods-e.periods[0].length,e.periods.shift(),e.number_of_periods=e.number_of_periods-1,e.end_of_periods_block=e.periods[0].end_block;var a,o=Object(m.a)(t);try{for(o.s();!(a=o.n()).done;){a.value.rewards.shift()}}catch(s){o.e(s)}finally{o.f()}}}function L(e){return new Promise((function(t){return setTimeout(t,e)}))}var z=r(348);function J(e){return Q.apply(this,arguments)}function Q(){return(Q=Object(u.a)(p.a.mark((function e(t){var r,n,a,o,s,c,i,l,u,d,f,b,h,g,_,w,k,y,x;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=new z.Workbook,n=r.addWorksheet("Report",{views:[{state:"frozen",ySplit:3}]}),a=["","","","",""],o=["","","","",""],s=["Guardian Address","Guardian Name","Certified","Type","Delegaor Address"],c=[],i=t.details.number_of_periods-1;i>=0;i--)a.push("".concat(q(t.details.periods[i].start_block_time)," to ").concat(q(t.details.periods[i].end_block_time)," GMT")),o.push("".concat(t.details.periods[i].start_block," to ").concat(t.details.periods[i].end_block," (").concat(t.details.periods[i].length," blocks)")),s.push("Distributed (ORBS)"),c.push(0);n.addRows([a,o,s]),l=Object(m.a)(t.participants);try{for(l.s();!(u=l.n()).done;){if(d=u.value,f=[d.guardianAddress,d.guardianName,d.guardianCertified,d.type,d.delegatorAddress||""],0===d.rewards.length)f.push("Missing Data");else{for(b=d.rewards.length;b<t.details.number_of_periods;b++)f.push(0);for(h=d.rewards.length-1;h>=0;h--)f.push(d.rewards[h]),"Total"===d.type&&(c[t.details.number_of_periods-1-h]=c[t.details.number_of_periods-1-h]+d.rewards[h])}n.addRow(f)}}catch(p){l.e(p)}finally{l.f()}for(g=n.addRow(["","","","","Total Distributed:"].concat(c)),n.getColumn(1).width=42,n.getColumn(2).width=35,n.getColumn(3).width=8,n.getColumn(4).width=35,n.getColumn(5).width=42,_=0;_<t.details.number_of_periods;_++)n.getColumn(6+_).width=40;for(n.getRow(3).font={bold:!0},w=4;w<4+t.participants.length;w++)for("Total"===(k=n.getRow(w)).getCell(4).value?(k.font={bold:!0},k.border={top:{style:"thin"}},k.getCell(5).border={top:{style:"thin"},right:{style:"thin"}}):k.getCell(5).border={right:{style:"thin"}},y=6;y<6+t.details.number_of_periods;y++)k.getCell(y).numFmt="#,##0.00";for(g.font={bold:!0},g.getCell(1).border={top:{style:"thin"}},g.getCell(2).border={top:{style:"thin"}},g.getCell(3).border={top:{style:"thin"}},g.getCell(4).border={top:{style:"thin"}},g.getCell(5).border={top:{style:"thin"},right:{style:"thin"}},x=6;x<6+t.details.number_of_periods;x++)g.getCell(x).numFmt="#,##0.00",g.getCell(x).border={top:{style:"double"}};return e.abrupt("return",r.xlsx.writeBuffer());case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){var t=new Date(1e3*e).toISOString();return t.slice(0,10)+" "+t.slice(11,19)}var H=r(32),X={1:"https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9",137:"https://polygon-mainnet.g.alchemy.com/v2/c93z5UqYd5bR2paVR7PtUXhkVEIDIex0"},Y={1:["https://0xcore-management-direct.global.ssl.fastly.net/status"],137:["https://0xcore-matic-reader-direct.global.ssl.fastly.net/status"]};function K(e,t,r,n){return Z.apply(this,arguments)}function Z(){return(Z=Object(u.a)(p.a.mark((function e(t,r,n,a){var o,s,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=X[r],s=Y[r],c={period_in_blocks:new Number(t).valueOf(),periods:new Number(n).valueOf(),show_only_full_periods:"true"===a},e.next=5,O(o,r,s,c);case 5:return i=e.sent,e.abrupt("return",J(i));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){var r=window.URL.createObjectURL(new Blob([e])),n=document.createElement("a");n.href=r,n.setAttribute("download","".concat(t,".").concat((new Date).toISOString(),".xlsx")),n.setAttribute("type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)}var ee=[{key:"Quarterly",text:"Quarterly (91 days)",value:"604800"},{key:"Monthly",text:"Monthly (30 days)",value:"199385"},{key:"Weekly",text:"Weekly (7 days)",value:"46525"}],te=[{key:"Ethereum",text:"Ethereum",value:"1"},{key:"Polygon",text:"Polygon",value:"137"}];var re=function(){var e=Object(n.useState)({reportType:"604800",networkType:"1",reportPeriods:"3",reportShowFull:"false",reportFilenamePrefix:"report"}),t=Object(l.a)(e,2),r=t[0],a=t[1],o=Object(n.useState)(!1),s=Object(l.a)(o,2),d=s[0],g=s[1],m=function(e,t){var n=t.name,o=t.value;return a(Object(i.a)(Object(i.a)({},r),{},Object(c.a)({},n,o)))},_=function(){var e=Object(u.a)(p.a.mark((function e(){var t,n,a,o,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.reportType,n=r.networkType,a=r.reportPeriods,o=r.reportShowFull,s=r.reportFilenamePrefix,g(!0),e.next=4,K(t,n,a,o);case 4:$(e.sent,s),g(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(H.jsxs)("div",{className:"App",children:[Object(H.jsx)("h2",{children:"Orbs Rewards Report Generator"}),Object(H.jsx)("br",{}),Object(H.jsx)(f.a,{textAlign:"left",children:Object(H.jsx)(b.a,{textAlign:"left",secondary:!0,style:{width:"50vw",margin:"auto"},children:Object(H.jsxs)(h.a,{loading:d,onSubmit:_,spellcheck:"false",children:[Object(H.jsx)(h.a.Select,{label:"Network",name:"networkType",options:te,defaultValue:"1",onChange:m}),Object(H.jsx)(h.a.Select,{label:"Report Type",name:"reportType",options:ee,defaultValue:"604800",onChange:m}),Object(H.jsx)(h.a.Input,{label:"Number Of Report Periods",name:"reportPeriods",defaultValue:"3",onChange:m}),Object(H.jsx)(h.a.Checkbox,{radio:!0,label:"Show Only Full Periods",name:"reportShowFull",value:"true",checked:"true"===r.reportShowFull,onChange:m}),Object(H.jsx)(h.a.Checkbox,{radio:!0,label:"Show Last Partial Period",name:"reportShowFull",value:"false",checked:"false"===r.reportShowFull,onChange:m}),Object(H.jsx)(h.a.Input,{label:"File Name Prefix",name:"reportFilenamePrefix",defaultValue:"report",onChange:m}),Object(H.jsx)(h.a.Button,{primary:!0,children:"Submit"})]})})})]})};s.a.render(Object(H.jsx)(a.a.StrictMode,{children:Object(H.jsx)(re,{})}),document.getElementById("root"))}},[[716,1,2]]]);
//# sourceMappingURL=main.a6faa98e.chunk.js.map