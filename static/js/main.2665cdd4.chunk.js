(this.webpackJsonporbs=this.webpackJsonporbs||[]).push([[0],{322:function(e,t){},359:function(e,t,r){},361:function(e,t,r){},374:function(e,t){},398:function(e,t){},400:function(e,t){},477:function(e,t){},479:function(e,t){},488:function(e,t){},490:function(e,t){},515:function(e,t){},521:function(e,t){},534:function(e,t){},650:function(e,t){},651:function(e,t){},657:function(e,t,r){"use strict";r.r(t);var a=r(33),n=r(0),s=r.n(n),o=r(85),c=r.n(o),i=(r(358),r(359),r(23)),u=r.n(i),l=r(148),d=r(215),p=r(221),f=r(36),b=r(673),h=r(675),_=r(674),g=(r(361),r(167)),w=r(131),m=r(18),k=r.n(m),x=r(74),v=604800,y=Object(x.getStartOfRewardsBlock)(),j=["0x4aca0c63e351b2ea44ee628425710e933b5b3396","0xca0ff0479bd7f52e55e65da7b76074b477b734b3"];function O(e,t,r){return S.apply(this,arguments)}function S(){return(S=Object(f.a)(u.a.mark((function e(t,r,a){var n,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=[],s=[],o=a.exclude_guardians||j,e.t0=k.a,e.next=6,Object(x.getGuardians)(r);case 6:return e.t1=e.sent,e.t2=function(e){o.includes(e.address)||(n.push(e.address),s.push(!e.certified))},e.t0.forEach.call(e.t0,e.t1,e.t2),e.abrupt("return",R(n,s,t,a));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t,r,a){return A.apply(this,arguments)}function A(){return(A=Object(f.a)(u.a.mark((function e(t,r,a,n){var s,o,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k.a.isString(a)){e.next=6;break}return e.next=3,Object(x.getWeb3)(a);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=a;case 7:return s=e.t0,e.next=10,P(n,s);case 10:o=e.sent,c=[],i=0;case 13:if(!(i<t.length)){e.next=32;break}return e.prev=14,e.t1=c.push,e.t2=c,e.t3=g.a,e.next=20,D(t[i],r[i],s,o);case 20:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5),e.next=29;break;case 25:e.prev=25,e.t6=e.catch(14),c.push({guardianAddress:t[i],rewards:[]}),console.log("Error while generating guardian ".concat(t[i],": ").concat(e.t6," ... (skipped)"));case 29:i++,e.next=13;break;case 32:return V(o,c,n),e.abrupt("return",{details:o,participants:c});case 34:case"end":return e.stop()}}),e,null,[[14,25]])})))).apply(this,arguments)}function P(e,t){return C.apply(this,arguments)}function C(){return(C=Object(f.a)(u.a.mark((function e(t,r){var a,n,s,o,c,i,l,d,p,f;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.eth.getBlock("latest");case 2:a=e.sent,n=[],s=t.period_in_blocks||v,o=(t.periods||3)+(!0===t.show_only_full_periods?1:0),c=[],i=a.number,l=a.number-s+1>y.number?a.number-(a.number-y.number)%s:y.number,d=0;do{n.push({start_block:l,start_block_time:0,end_block:i,end_block_time:0,length:i-l+1}),d+=i-l+1,c.push(r.eth.getBlock(l)),l=(i=l-1)-s+1}while(n.length<o&&l>=y.number);return e.next=13,Promise.all(c);case 13:for(p=e.sent,f=0;f<n.length;f++)n[f].end_block_time=Number(0===f?a.timestamp:p[f-1].timestamp-13),n[f].start_block_time=Number(p[f].timestamp);return e.abrupt("return",{number_of_periods:n.length,total_length_of_periods:d,start_of_periods_block:n[n.length-1].start_block,end_of_periods_block:n[0].end_block,periods:n});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e,t,r,a){return F.apply(this,arguments)}function F(){return(F=Object(f.a)(u.a.mark((function e(t,r,a,n){var s,o,c,i;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={read_from_block:n.start_of_periods_block-1e4},o=[],e.prev=2,e.next=5,Object(x.getGuardian)(t,a,s);case 5:c=e.sent,e.next=15;break;case 8:return e.prev=8,e.t0=e.catch(2),console.log("Error while generating guardian ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),W(1e3),e.next=14,Object(x.getGuardian)(t,a,s);case 14:c=e.sent;case 15:if(i=N(c,n.periods),o.push(L(c,"Total",i.allGuardianRewards)),o.push(L(c,"Self-Share (guardian + self-delegate)",i.guardianSelfRewards)),o.push(L(c,"Delegators",i.sumDelegatorRewards)),!r){e.next=22;break}return e.next=22,T(c,a,s,n.periods,o);case 22:return e.abrupt("return",o);case 23:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function N(e,t){for(var r=1/(1-e.reward_status.delegator_reward_share),a=e.reward_status.delegator_reward_share/(1-e.reward_status.delegator_reward_share),n=G(e.reward_as_guardian_slices,e.address,t),s=G(e.reward_as_delegator_slices,e.address,t),o=[],c=[],i=0;i<n.length;i++)o.push(n[i]+s[i]),c.push(n[i]*a-s[i]);return{allGuardianRewards:k.a.map(n,(function(e){return e*r})),sumDelegatorRewards:c,guardianSelfRewards:o}}function G(e,t,r){for(var a=[],n=0,s=0,o=0;n<r.length&&o<e.length-1;o++)if(k.a.isUndefined(e[o].guardian_from)||e[o].guardian_from===t)if(e[o+1].block_number>=r[n].start_block)s+=e[o].total_awarded-e[o+1].total_awarded;else{var c=e[o].total_awarded-e[o+1].total_awarded,i=e[o].block_number-e[o+1].block_number,u=c*(e[o].block_number-r[n].start_block+1)/i;s+=u,a.push(s),s=c-u,n++}else e[o+1].block_number<=r[n].start_block&&(a.push(s),s=0,n++);return n<r.length&&a.push(s),a}function T(e,t,r,a,n){return B.apply(this,arguments)}function B(){return(B=Object(f.a)(u.a.mark((function e(t,r,a,n,s){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E(t,t.delegators,!1,r,a,n,s);case 2:return e.next=4,E(t,t.delegators_left,!0,r,a,n,s);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,r,a,n,s,o){return I.apply(this,arguments)}function I(){return(I=Object(f.a)(u.a.mark((function e(t,r,a,n,s,o,c){var i,l,d,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(w.a)(r),e.prev=1,i.s();case 3:if((l=i.n()).done){e.next=23;break}return d=l.value,p=[],e.prev=6,e.t0=G,e.next=10,M(d.address,n,s);case 10:e.t1=e.sent,e.t2=t.address,e.t3=o,p=(0,e.t0)(e.t1,e.t2,e.t3),e.next=19;break;case 16:e.prev=16,e.t4=e.catch(6),console.log("Error while generating ".concat(a?"historical":""," delegator ").concat(d.address,": ").concat(e.t4.stack," ... (skipped)"));case 19:return c.push(L(t,a?"Historical Delegator":"Delegator",p,d.address)),e.abrupt("break",23);case 21:e.next=3;break;case 23:e.next=28;break;case 25:e.prev=25,e.t5=e.catch(1),i.e(e.t5);case 28:return e.prev=28,i.f(),e.finish(28);case 31:case"end":return e.stop()}}),e,null,[[1,25,28,31],[6,16]])})))).apply(this,arguments)}function M(e,t,r){return U.apply(this,arguments)}function U(){return(U=Object(f.a)(u.a.mark((function e(t,r,a){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(x.getDelegatorStakingRewards)(t,r,a);case 3:return e.abrupt("return",e.sent.rewards);case 6:return e.prev=6,e.t0=e.catch(0),console.log("Error while generating delegator ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),W(1e3),e.next=12,Object(x.getDelegatorStakingRewards)(t,r,a);case 12:return e.abrupt("return",e.sent.rewards);case 13:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function L(e,t,r,a){return{guardianAddress:e.address,guardianName:e.details.name,guardianCertified:e.details.certified,type:t,delegatorAddress:a,rewards:r}}function V(e,t,r){var a=r.period_in_blocks||v;if(e.periods.length>1&&e.periods[0].length<a&&!0===r.show_only_full_periods){e.total_length_of_periods=e.total_length_of_periods-e.periods[0].length,e.periods.shift(),e.number_of_periods=e.number_of_periods-1,e.end_of_periods_block=e.periods[0].end_block;var n,s=Object(w.a)(t);try{for(s.s();!(n=s.n()).done;){n.value.rewards.shift()}}catch(o){s.e(o)}finally{s.f()}}}function W(e){return new Promise((function(t){return setTimeout(t,e)}))}var J=r(19),Q=r.n(J);function z(e,t){for(var r=Q.a.utils.book_new(),a=[],n=[{wch:42},{wch:35},{wch:5},{wch:35},{wch:42}],s=["","","","",""],o=["","","","",""],c=["","","","",""],i=["Guardian Address","Guardian Name","Certified","Type","Delegaor Address"],u=0;u<e.details.number_of_periods;u++)s.push("Period ".concat(u+1)),o.push("".concat(H(e.details.periods[u].start_block_time)," to ").concat(H(e.details.periods[u].end_block_time)," GMT")),c.push("".concat(e.details.periods[u].start_block," to ").concat(e.details.periods[u].end_block," (").concat(e.details.periods[u].length," blocks)")),i.push("Distributed (ORBS)"),n.push({wch:40});a.push(s,o,c,i);var l,d=Object(w.a)(e.participants);try{for(d.s();!(l=d.n()).done;){var p=l.value,f=[p.guardianAddress,p.guardianName,p.guardianCertified,p.type,p.delegatorAddress||""].concat(Object(g.a)(p.rewards));0===p.rewards.length&&f.push("Missing Data"),a.push(f)}}catch(v){d.e(v)}finally{d.f()}var b=Q.a.utils.aoa_to_sheet(a);b["!cols"]=n;for(var h={r:4,c:5},_={r:4+e.participants.length-1,c:5+e.details.number_of_periods-1},m=h.r;m<=_.r;++m)for(var k=h.c;k<=_.c;++k){var x=b[Q.a.utils.encode_cell({r:m,c:k})];x?(x.z="#,##0.00",x.t="n"):console.log(Q.a.utils.encode_cell({r:m,c:k}))}return Q.a.utils.book_append_sheet(r,b,"Report"),Q.a.write(r,{bookType:"xlsx",type:t})}function H(e){var t=new Date(1e3*e).toISOString();return t.slice(0,10)+" "+t.slice(11,19)}function q(e,t,r){return K.apply(this,arguments)}function K(){return(K=Object(f.a)(u.a.mark((function e(t,r,a){var n,s,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9",n=["https://0xcore.orbs.com/services/management-service/status"],s={period_in_blocks:new Number(t).valueOf(),periods:new Number(r).valueOf(),show_only_full_periods:"true"===a},e.next=5,O("https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9",n,s);case 5:return o=e.sent,e.abrupt("return",z(o,"binary"));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function X(e){for(var t=new ArrayBuffer(e.length),r=new Uint8Array(t),a=0;a<e.length;a++)r[a]=255&e.charCodeAt(a);return t}function Y(e,t){var r=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.href=r,a.setAttribute("download","".concat(t,".").concat((new Date).toISOString(),".xlsx")),a.setAttribute("type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a)}var Z=[{key:"Quarterly",text:"Quarterly (91 days)",value:"604800"},{key:"Monthly",text:"Monthly (30 days)",value:"199385"},{key:"Weekly",text:"Weekly (7 days)",value:"46525"}];var $=function(){var e=Object(n.useState)({reportType:"604800",reportPeriods:"3",reportShowFull:"false",reportFilenamePrefix:"report"}),t=Object(p.a)(e,2),r=t[0],s=t[1],o=Object(n.useState)(!1),c=Object(p.a)(o,2),i=c[0],g=c[1],w=function(e,t){var a=t.name,n=t.value;return s(Object(d.a)(Object(d.a)({},r),{},Object(l.a)({},a,n)))},m=function(){var e=Object(f.a)(u.a.mark((function e(){var t,a,n,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.reportType,a=r.reportPeriods,n=r.reportShowFull,s=r.reportFilenamePrefix,g(!0),e.next=4,q(t,a,n);case 4:Y(X(e.sent),s),g(!1);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.jsxs)("div",{className:"App",children:[Object(a.jsx)("h2",{children:"Orbs Rewards Report Generator"}),Object(a.jsx)("br",{}),Object(a.jsx)(b.a,{textAlign:"left",children:Object(a.jsx)(h.a,{textAlign:"left",secondary:!0,style:{width:"50vw",margin:"auto"},children:Object(a.jsxs)(_.a,{loading:i,onSubmit:m,spellcheck:"false",children:[Object(a.jsx)(_.a.Select,{label:"Report Type",name:"reportType",options:Z,defaultValue:"604800",onChange:w}),Object(a.jsx)(_.a.Input,{label:"Number Of Report Periods",name:"reportPeriods",defaultValue:"3",onChange:w}),Object(a.jsx)(_.a.Checkbox,{radio:!0,label:"Show Only Full Periods",name:"reportShowFull",value:"true",checked:"true"===r.reportShowFull,onChange:w}),Object(a.jsx)(_.a.Checkbox,{radio:!0,label:"Show Last Partial Period",name:"reportShowFull",value:"false",checked:"false"===r.reportShowFull,onChange:w}),Object(a.jsx)(_.a.Input,{label:"File Name Prefix",name:"reportFilenamePrefix",defaultValue:"report",onChange:w}),Object(a.jsx)(_.a.Button,{primary:!0,children:"Submit"})]})})})]})};c.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)($,{})}),document.getElementById("root"))}},[[657,1,2]]]);
//# sourceMappingURL=main.2665cdd4.chunk.js.map