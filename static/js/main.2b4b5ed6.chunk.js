(this.webpackJsonporbs=this.webpackJsonporbs||[]).push([[0],{332:function(e,t){},372:function(e,t,r){},374:function(e,t,r){},389:function(e,t){},391:function(e,t){},396:function(e,t){},397:function(e,t){},424:function(e,t){},426:function(e,t){},440:function(e,t){},442:function(e,t){},457:function(e,t){},475:function(e,t){},477:function(e,t){},495:function(e,t){},496:function(e,t){},564:function(e,t){},566:function(e,t){},572:function(e,t){},584:function(e,t){},587:function(e,t){},592:function(e,t){},676:function(e,t){},713:function(e,t){},714:function(e,t){},721:function(e,t,r){"use strict";r.r(t);var a=r(0),n=r.n(a),o=r(93),s=r.n(o),i=(r(371),r(372),r(155)),l=r(225),c=r(230),u=r(35),d=r(20),p=r.n(d),f=r(737),b=r(739),h=r(738),g=(r(374),r(351)),m=r(135),_=r(16),w=r.n(_),y=r(62),k=604800,x=Object(y.getStartOfRewardsBlock)(),v=["0x4aca0c63e351b2ea44ee628425710e933b5b3396","0xca0ff0479bd7f52e55e65da7b76074b477b734b3"],j={ethereum:y.getWeb3,polygon:y.getWeb3Polygon};function O(e,t,r,a,n){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(p.a.mark((function e(t,r,a,n,o){var s,i,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=[],i=[],l=o.exclude_guardians||v,e.t0=w.a,e.next=6,Object(y.getGuardians)(a,n);case 6:return e.t1=e.sent,e.t2=function(e){l.includes(e.address)||(s.push(e.address),i.push(!e.certified))},e.t0.forEach.call(e.t0,e.t1,e.t2),e.abrupt("return",C(s,r,i,t,o));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e,t,r,a,n){return R.apply(this,arguments)}function R(){return(R=Object(u.a)(p.a.mark((function e(t,r,a,n,o){var s,i,l,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w.a.isString(n)){e.next=6;break}return e.next=3,j[r](n);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=n;case 7:return s=e.t0,e.next=10,A(o,s);case 10:i=e.sent,l=[],c=0;case 13:if(!(c<t.length)){e.next=32;break}return e.prev=14,e.t1=l.push,e.t2=l,e.t3=g.a,e.next=20,P(t[c],a[c],s,i);case 20:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5),e.next=29;break;case 25:e.prev=25,e.t6=e.catch(14),l.push({guardianAddress:t[c],rewards:[]}),console.log("Error while generating guardian ".concat(t[c],": ").concat(e.t6," ... (skipped)"));case 29:c++,e.next=13;break;case 32:return U(i,l,o),e.abrupt("return",{details:i,participants:l});case 34:case"end":return e.stop()}}),e,null,[[14,25]])})))).apply(this,arguments)}function A(e,t){return D.apply(this,arguments)}function D(){return(D=Object(u.a)(p.a.mark((function e(t,r){var a,n,o,s,i,l,c,u,d,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.eth.getBlock("latest");case 2:a=e.sent,n=[],o=t.period_in_blocks||k,s=(t.periods||3)+(!0===t.show_only_full_periods?1:0),i=[],l=a.number,c=a.number-o+1>x.number?a.number-(a.number-x.number)%o:x.number,u=0;do{n.push({start_block:c,start_block_time:0,end_block:l,end_block_time:0,length:l-c+1}),u+=l-c+1,i.push(r.eth.getBlock(c)),c=(l=c-1)-o+1}while(n.length<s&&c>=x.number);return e.next=13,Promise.all(i);case 13:for(d=e.sent,f=0;f<n.length;f++)n[f].end_block_time=Number(0===f?a.timestamp:d[f-1].timestamp-13),n[f].start_block_time=Number(d[f].timestamp);return e.abrupt("return",{number_of_periods:n.length,total_length_of_periods:u,start_of_periods_block:n[n.length-1].start_block,end_of_periods_block:n[0].end_block,periods:n});case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,r,a){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(p.a.mark((function e(t,r,a,n){var o,s,i,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={read_from_block:n.start_of_periods_block-1e4},s=[],e.prev=2,e.next=5,Object(y.getGuardian)(t,a,o);case 5:i=e.sent,e.next=15;break;case 8:return e.prev=8,e.t0=e.catch(2),console.log("Error while generating guardian ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),H(1e3),e.next=14,Object(y.getGuardian)(t,a,o);case 14:i=e.sent;case 15:if(i.details.certified=!r,l=F(i,n.periods),s.push(M(i,"Total",l.allGuardianRewards)),s.push(M(i,"Self-Share (guardian + self-delegate)",l.guardianSelfRewards)),s.push(M(i,"Total Delegators",l.sumDelegatorRewards)),!r){e.next=23;break}return e.next=23,E(i,a,o,n.periods,s);case 23:return e.abrupt("return",s);case 24:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function F(e,t){for(var r=1/(1-e.reward_status.delegator_reward_share),a=e.reward_status.delegator_reward_share/(1-e.reward_status.delegator_reward_share),n=N(e.reward_as_guardian_slices,e.address,t),o=N(e.reward_as_delegator_slices,e.address,t),s=[],i=[],l=0;l<n.length;l++){var c=l<o.length?o[l]:0;s.push(n[l]+c),i.push(n[l]*a-c)}return{allGuardianRewards:w.a.map(n,(function(e){return e*r})),sumDelegatorRewards:i,guardianSelfRewards:s}}function N(e,t,r){for(var a=[],n=0,o=0,s=0;n<r.length&&s<e.length-1;s++)if(w.a.isUndefined(e[s].guardian_from)||e[s].guardian_from===t)if(e[s+1].block_number>=r[n].start_block)o+=e[s].total_awarded-e[s+1].total_awarded;else{var i=e[s].total_awarded-e[s+1].total_awarded,l=e[s].block_number-e[s+1].block_number,c=i*(e[s].block_number-r[n].start_block+1)/l;o+=c,a.push(o),o=i-c,n++}else e[s+1].block_number<=r[n].start_block&&(a.push(o),o=0,n++);return n<r.length&&a.push(o),a}function E(e,t,r,a,n){return G.apply(this,arguments)}function G(){return(G=Object(u.a)(p.a.mark((function e(t,r,a,n,o){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B(t,t.delegators,!1,r,a,n,o);case 2:return e.next=4,B(t,t.delegators_left,!0,r,a,n,o);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t,r,a,n,o,s){return I.apply(this,arguments)}function I(){return(I=Object(u.a)(p.a.mark((function e(t,r,a,n,o,s,i){var l,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=Object(m.a)(r),e.prev=1,l.s();case 3:if((c=l.n()).done){e.next=22;break}return u=c.value,d=[],e.prev=6,e.t0=N,e.next=10,V(u.address,n,o);case 10:e.t1=e.sent,e.t2=t.address,e.t3=s,d=(0,e.t0)(e.t1,e.t2,e.t3),e.next=19;break;case 16:e.prev=16,e.t4=e.catch(6),console.log("Error while generating ".concat(a?"historical":""," delegator ").concat(u.address,": ").concat(e.t4.stack," ... (skipped)"));case 19:i.push(M(t,a?"Historical Delegator":"Delegator",d,u.address));case 20:e.next=3;break;case 22:e.next=27;break;case 24:e.prev=24,e.t5=e.catch(1),l.e(e.t5);case 27:return e.prev=27,l.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[1,24,27,30],[6,16]])})))).apply(this,arguments)}function V(e,t,r){return W.apply(this,arguments)}function W(){return(W=Object(u.a)(p.a.mark((function e(t,r,a){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(y.getDelegatorStakingRewards)(t,r,a);case 3:case 12:return e.abrupt("return",e.sent.rewards);case 6:return e.prev=6,e.t0=e.catch(0),console.log("Error while generating delegator ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),H(1e3),e.next=12,Object(y.getDelegatorStakingRewards)(t,r,a);case 13:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function M(e,t,r,a){return{guardianAddress:e.address,guardianName:e.details.name,guardianCertified:e.details.certified,type:t,delegatorAddress:a,rewards:r}}function U(e,t,r){var a=r.period_in_blocks||k;if(e.periods.length>1&&e.periods[0].length<a&&!0===r.show_only_full_periods){e.total_length_of_periods=e.total_length_of_periods-e.periods[0].length,e.periods.shift(),e.number_of_periods=e.number_of_periods-1,e.end_of_periods_block=e.periods[0].end_block;var n,o=Object(m.a)(t);try{for(o.s();!(n=o.n()).done;){n.value.rewards.shift()}}catch(s){o.e(s)}finally{o.f()}}}function H(e){return new Promise((function(t){return setTimeout(t,e)}))}var L=r(348);function z(e){return J.apply(this,arguments)}function J(){return(J=Object(u.a)(p.a.mark((function e(t){var r,a,n,o,s,i,l,c,u,d,f,b,h,g,_,w,y,k,x;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=new L.Workbook,a=r.addWorksheet("Report",{views:[{state:"frozen",ySplit:3}]}),n=["","","","",""],o=["","","","",""],s=["Guardian Address","Guardian Name","Certified","Type","Delegaor Address"],i=[],l=t.details.number_of_periods-1;l>=0;l--)n.push("".concat(Q(t.details.periods[l].start_block_time)," to ").concat(Q(t.details.periods[l].end_block_time)," GMT")),o.push("".concat(t.details.periods[l].start_block," to ").concat(t.details.periods[l].end_block," (").concat(t.details.periods[l].length," blocks)")),s.push("Distributed (ORBS)"),i.push(0);a.addRows([n,o,s]),c=Object(m.a)(t.participants);try{for(c.s();!(u=c.n()).done;){if(d=u.value,f=[d.guardianAddress,d.guardianName,d.guardianCertified,d.type,d.delegatorAddress||""],0===d.rewards.length)f.push("Missing Data");else{for(b=d.rewards.length;b<t.details.number_of_periods;b++)f.push(0);for(h=d.rewards.length-1;h>=0;h--)f.push(d.rewards[h]),"Total"===d.type&&(i[t.details.number_of_periods-1-h]=i[t.details.number_of_periods-1-h]+d.rewards[h])}a.addRow(f)}}catch(p){c.e(p)}finally{c.f()}for(g=a.addRow(["","","","","Total Distributed:"].concat(i)),a.getColumn(1).width=42,a.getColumn(2).width=35,a.getColumn(3).width=8,a.getColumn(4).width=35,a.getColumn(5).width=42,_=0;_<t.details.number_of_periods;_++)a.getColumn(6+_).width=40;for(a.getRow(3).font={bold:!0},w=4;w<4+t.participants.length;w++)for("Total"===(y=a.getRow(w)).getCell(4).value?(y.font={bold:!0},y.border={top:{style:"thin"}},y.getCell(5).border={top:{style:"thin"},right:{style:"thin"}}):y.getCell(5).border={right:{style:"thin"}},k=6;k<6+t.details.number_of_periods;k++)y.getCell(k).numFmt="#,##0.00";for(g.font={bold:!0},g.getCell(1).border={top:{style:"thin"}},g.getCell(2).border={top:{style:"thin"}},g.getCell(3).border={top:{style:"thin"}},g.getCell(4).border={top:{style:"thin"}},g.getCell(5).border={top:{style:"thin"},right:{style:"thin"}},x=6;x<6+t.details.number_of_periods;x++)g.getCell(x).numFmt="#,##0.00",g.getCell(x).border={top:{style:"double"}};return e.abrupt("return",r.xlsx.writeBuffer());case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e){var t=new Date(1e3*e).toISOString();return t.slice(0,10)+" "+t.slice(11,19)}var q=r(32),X={ethereum:"https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9",polygon:"https://polygon-mainnet.g.alchemy.com/v2/c93z5UqYd5bR2paVR7PtUXhkVEIDIex0"},Y={ethereum:["https://0xcore-management-direct.global.ssl.fastly.net/status"],polygon:["https://0xcore-matic-reader-direct.global.ssl.fastly.net/status"]};function K(e,t,r,a){return Z.apply(this,arguments)}function Z(){return(Z=Object(u.a)(p.a.mark((function e(t,r,a,n){var o,s,i,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=X[r],s=Y[r],i=Y.ethereum,l={period_in_blocks:new Number(t).valueOf(),periods:new Number(a).valueOf(),show_only_full_periods:"true"===n},e.next=6,O(o,r,s,i,l);case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,t){for(var r={details:e.details,participants:[]},a=e.participants.concat(t.participants),n=0;n<a.length-1;n++){for(var o=!1,s=function(e){if(a[n].guardianAddress===a[e].guardianAddress&&a[n].type===a[e].type&&(!["Delegator","Historical Delegator"].includes(a[n].type)||a[n].delegatorAddress===a[e].delegatorAddress)){o=!0;var t=a[n];return t.rewards=a[n].rewards.map((function(t,r){return t+a[e].rewards[r]})),r.participants.push(t),a.splice(e,1),"break"}},i=n+1;i<a.length;i++){if("break"===s(i))break}o||r.participants.push(a[n])}var l=["Total","Self-Share (guardian + self-delegate)","Total Delegators","Delegator","Historical Delegator"];return r.participants.sort((function(e,t){return e.guardianAddress===t.guardianAddress?l.indexOf(e.type)-l.indexOf(t.type):e.guardianAddress>t.guardianAddress?1:-1})),r}function ee(e,t){var r=window.URL.createObjectURL(new Blob([e])),a=document.createElement("a");a.href=r,a.setAttribute("download","".concat(t,".").concat((new Date).toISOString(),".xlsx")),a.setAttribute("type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),document.body.appendChild(a),a.click(),a.parentNode.removeChild(a)}var te=[{key:"Quarterly",text:"Quarterly (91 days)",value:"604800"},{key:"Monthly",text:"Monthly (30 days)",value:"199385"},{key:"Weekly",text:"Weekly (7 days)",value:"46525"}],re=[{key:"All",text:"All",value:"all"},{key:"Ethereum",text:"Ethereum",value:"ethereum"},{key:"Polygon",text:"Polygon",value:"polygon"}];var ae=function(){var e=Object(a.useState)({reportType:"604800",networkType:"all",reportPeriods:"3",reportShowFull:"false",reportFilenamePrefix:"report"}),t=Object(c.a)(e,2),r=t[0],n=t[1],o=Object(a.useState)(!1),s=Object(c.a)(o,2),d=s[0],g=s[1],m=function(e,t){var a=t.name,o=t.value;return n(Object(l.a)(Object(l.a)({},r),{},Object(i.a)({},a,o)))},_=function(){var e=Object(u.a)(p.a.mark((function e(){var t,a,n,o,s,i,l,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.reportType,a=r.networkType,n=r.reportPeriods,o=r.reportShowFull,s=r.reportFilenamePrefix,g(!0),i=null,"all"!==a){e.next=13;break}return e.next=6,K(t,"ethereum",n,o);case 6:return l=e.sent,e.next=9,K(t,"polygon",n,o);case 9:c=e.sent,i=$(l,c),e.next=16;break;case 13:return e.next=15,K(t,a,n,o);case 15:i=e.sent;case 16:return e.next=18,z(i);case 18:ee(e.sent,s),g(!1);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(q.jsxs)("div",{className:"App",children:[Object(q.jsx)("h2",{children:"Orbs Rewards Report Generator"}),Object(q.jsx)("br",{}),Object(q.jsx)(f.a,{textAlign:"left",children:Object(q.jsx)(b.a,{textAlign:"left",secondary:!0,style:{width:"50vw",margin:"auto"},children:Object(q.jsxs)(h.a,{loading:d,onSubmit:_,spellcheck:"false",children:[Object(q.jsx)(h.a.Select,{label:"Network",name:"networkType",options:re,defaultValue:"all",onChange:m}),Object(q.jsx)(h.a.Select,{label:"Report Type",name:"reportType",options:te,defaultValue:"604800",onChange:m}),Object(q.jsx)(h.a.Input,{label:"Number Of Report Periods",name:"reportPeriods",defaultValue:"3",onChange:m}),Object(q.jsx)(h.a.Checkbox,{radio:!0,label:"Show Only Full Periods",name:"reportShowFull",value:"true",checked:"true"===r.reportShowFull,onChange:m}),Object(q.jsx)(h.a.Checkbox,{radio:!0,label:"Show Last Partial Period",name:"reportShowFull",value:"false",checked:"false"===r.reportShowFull,onChange:m}),Object(q.jsx)(h.a.Input,{label:"File Name Prefix",name:"reportFilenamePrefix",defaultValue:"report",onChange:m}),Object(q.jsx)(h.a.Button,{primary:!0,children:"Submit"})]})})})]})};s.a.render(Object(q.jsx)(n.a.StrictMode,{children:Object(q.jsx)(ae,{})}),document.getElementById("root"))}},[[721,1,2]]]);
//# sourceMappingURL=main.2b4b5ed6.chunk.js.map