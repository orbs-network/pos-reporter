(this.webpackJsonporbs=this.webpackJsonporbs||[]).push([[0],{326:function(e,t){},363:function(e,t,r){},365:function(e,t,r){},383:function(e,t){},385:function(e,t){},390:function(e,t){},391:function(e,t){},418:function(e,t){},420:function(e,t){},434:function(e,t){},436:function(e,t){},451:function(e,t){},469:function(e,t){},471:function(e,t){},489:function(e,t){},490:function(e,t){},558:function(e,t){},560:function(e,t){},566:function(e,t){},578:function(e,t){},581:function(e,t){},586:function(e,t){},671:function(e,t){},720:function(e,t){},721:function(e,t){},729:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),s=r(88),o=r.n(s),c=(r(362),r(363),r(151)),i=r(220),l=r(225),u=r(24),d=r(15),p=r.n(d),f=r(745),b=r(747),h=r(746),g=(r(365),r(342)),m=r(117),k=r(40),_=r.n(k),y=r(53),w=604800,x={1:13,137:2},v=Object(y.getStartOfRewardsBlock)(),j=["0x4aca0c63e351b2ea44ee628425710e933b5b3396","0xca0ff0479bd7f52e55e65da7b76074b477b734b3"],O={ethereum:y.getWeb3,polygon:y.getWeb3Polygon};function C(e,t){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(p.a.mark((function e(t,r){var n,a,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=137===r?"https://api.polygonscan.com/api?module=block&action=getblocknobytime&timestamp=".concat(t,"&closest=before&apikey=BEVY6JKW1VTU634UWBE2FZYKN3EDB3RZSR"):"https://api.etherscan.io/api?module=block&action=getblocknobytime&closest=before&timestamp=".concat(t,"&apikey=3U9E3HF8WYHXHCHNPP8E3AP8V7H2V8XU4T"),e.next=3,fetch(n);case 3:return a=e.sent,e.next=6,a.json();case 6:return"1"!==(s=e.sent).status&&alert("An error occurred. Please try again"),e.abrupt("return",parseInt(s.result));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,t,r,n,a,s){return A.apply(this,arguments)}function A(){return(A=Object(u.a)(p.a.mark((function e(t,r,n,a,s,o){var c,i,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=[],i=[],l=s.exclude_guardians||j,e.t0=_.a,e.next=6,Object(y.getGuardians)(n,a);case 6:return e.t1=e.sent,e.t2=function(e){l.includes(e.address)||(c.push(e.address),i.push(!e.certified))},e.t0.forEach.call(e.t0,e.t1,e.t2),e.abrupt("return",P(c,r,i,t,s,o));case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t,r,n,a,s){return D.apply(this,arguments)}function D(){return(D=Object(u.a)(p.a.mark((function e(t,r,n,a,s,o){var c,i,l,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!_.a.isString(a)){e.next=6;break}return e.next=3,O[r](a);case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=a;case 7:return c=e.t0,e.next=10,F(s,c,o);case 10:i=e.sent,l=[],u=0;case 13:if(!(u<t.length)){e.next=32;break}return e.prev=14,e.t1=l.push,e.t2=l,e.t3=g.a,e.next=20,E(t[u],n[u],c,i);case 20:e.t4=e.sent,e.t5=(0,e.t3)(e.t4),e.t1.apply.call(e.t1,e.t2,e.t5),e.next=29;break;case 25:e.prev=25,e.t6=e.catch(14),l.push({guardianAddress:t[u],rewards:[]}),console.log("Error while generating guardian ".concat(t[u],": ").concat(e.t6," ... (skipped)"));case 29:u++,e.next=13;break;case 32:return Y(i,l,s),e.abrupt("return",{details:i,participants:l});case 34:case"end":return e.stop()}}),e,null,[[14,25]])})))).apply(this,arguments)}function T(e,t){return B.apply(this,arguments)}function B(){return(B=Object(u.a)(p.a.mark((function e(t,r){var n,a,s,o,c,i,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.eth.getBlock("latest");case 2:n=e.sent,a=[],s=t.period_in_blocks||w,o=(t.periods||3)+(!0===t.show_only_full_periods?1:0),n.number,c=n.number-s+1>v.number?n.number-(n.number-v.number)%s:v.number;case 8:return e.next=10,r.eth.getBlock(c);case 10:i=e.sent,l=i.timestamp,a.push({number:c,time:l}),c=c-1-s+1;case 15:if(a.length<o&&c>=v.number){e.next=8;break}case 16:return e.abrupt("return",a);case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e,t,r){return N.apply(this,arguments)}function N(){return(N=Object(u.a)(p.a.mark((function e(t,r,n){var a,s,o,c,i,l,u,d,f,b,h,g,k;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.eth.getBlock("latest");case 2:return a=e.sent,s=[],o=t.period_in_blocks||w,e.next=7,r.eth.getChainId();case 7:c=e.sent,i=[],l=a.number,u=0,d=Object(m.a)(n),e.prev=12,d.s();case 14:if((f=d.n()).done){e.next=31;break}if(b=f.value,137!==c){e.next=22;break}return e.next=19,C(b.time,c);case 19:e.t0=e.sent,e.next=23;break;case 22:e.t0=b.number;case 23:h=e.t0,s.push({start_block:h,start_block_time:0,end_block:l,end_block_time:0,length:l-h+1}),u+=l-h+1,i.push(r.eth.getBlock(h)),h=(l=h-1)-o+1;case 29:e.next=14;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(12),d.e(e.t1);case 36:return e.prev=36,d.f(),e.finish(36);case 39:return e.next=41,Promise.all(i);case 41:for(g=e.sent,k=0;k<s.length;k++)s[k].end_block_time=Number(0===k?a.timestamp:g[k-1].timestamp-x[c]),s[k].start_block_time=Number(g[k].timestamp);return e.abrupt("return",{number_of_periods:s.length,total_length_of_periods:u,start_of_periods_block:s[s.length-1].start_block,end_of_periods_block:s[0].end_block,periods:s});case 44:case"end":return e.stop()}}),e,null,[[12,33,36,39]])})))).apply(this,arguments)}function E(e,t,r,n){return W.apply(this,arguments)}function W(){return(W=Object(u.a)(p.a.mark((function e(t,r,n,a){var s,o,c,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={read_from_block:a.start_of_periods_block-1e4},o=[],e.prev=2,e.next=5,Object(y.getGuardian)(t,n,s);case 5:c=e.sent,e.next=15;break;case 8:return e.prev=8,e.t0=e.catch(2),console.log("Error while generating guardian ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),K(1e3),e.next=14,Object(y.getGuardian)(t,n,s);case 14:c=e.sent;case 15:if(c.details.certified=!r,i=I(c,a.periods),o.push(L(c,"Total",i.allGuardianRewards)),o.push(L(c,"Self-Share (guardian + self-delegate)",i.guardianSelfRewards)),o.push(L(c,"Total Delegators",i.sumDelegatorRewards)),!r){e.next=23;break}return e.next=23,H(c,n,s,a.periods,o);case 23:return e.abrupt("return",o);case 24:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function I(e,t){for(var r=1/(1-e.reward_status.delegator_reward_share),n=e.reward_status.delegator_reward_share/(1-e.reward_status.delegator_reward_share),a=G(e.reward_as_guardian_slices,e.address,t),s=G(e.reward_as_delegator_slices,e.address,t),o=[],c=[],i=0;i<a.length;i++){var l=i<s.length?s[i]:0;o.push(a[i]+l),c.push(a[i]*n-l)}return{allGuardianRewards:_.a.map(a,(function(e){return e*r})),sumDelegatorRewards:c,guardianSelfRewards:o}}function G(e,t,r){for(var n=[],a=0,s=0,o=0;a<r.length&&o<e.length-1;o++)if(_.a.isUndefined(e[o].guardian_from)||e[o].guardian_from===t)if(e[o+1].block_number>=r[a].start_block)s+=e[o].total_awarded-e[o+1].total_awarded;else{var c=e[o].total_awarded-e[o+1].total_awarded,i=e[o].block_number-e[o+1].block_number,l=c*(e[o].block_number-r[a].start_block+1)/i;s+=l,n.push(s),s=c-l,a++}else e[o+1].block_number<=r[a].start_block&&(n.push(s),s=0,a++);a<r.length&&n.push(s);for(var u=n.length;u<r.length;u++)n.push(0);return n}function H(e,t,r,n,a){return V.apply(this,arguments)}function V(){return(V=Object(u.a)(p.a.mark((function e(t,r,n,a,s){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t,t.delegators,!1,r,n,a,s);case 2:return e.next=4,M(t,t.delegators_left,!0,r,n,a,s);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e,t,r,n,a,s,o){return U.apply(this,arguments)}function U(){return(U=Object(u.a)(p.a.mark((function e(t,r,n,a,s,o,c){var i,l,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Object(m.a)(r),e.prev=1,i.s();case 3:if((l=i.n()).done){e.next=22;break}return u=l.value,d=[],e.prev=6,e.t0=G,e.next=10,Q(u.address,a,s);case 10:e.t1=e.sent,e.t2=t.address,e.t3=o,d=(0,e.t0)(e.t1,e.t2,e.t3),e.next=19;break;case 16:e.prev=16,e.t4=e.catch(6),console.log("Error while generating ".concat(n?"historical":""," delegator ").concat(u.address,": ").concat(e.t4.stack," ... (skipped)"));case 19:c.push(L(t,n?"Historical Delegator":"Delegator",d,u.address));case 20:e.next=3;break;case 22:e.next=27;break;case 24:e.prev=24,e.t5=e.catch(1),i.e(e.t5);case 27:return e.prev=27,i.f(),e.finish(27);case 30:case"end":return e.stop()}}),e,null,[[1,24,27,30],[6,16]])})))).apply(this,arguments)}function Q(e,t,r){return J.apply(this,arguments)}function J(){return(J=Object(u.a)(p.a.mark((function e(t,r,n){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(y.getDelegatorStakingRewards)(t,r,n);case 3:case 12:return e.abrupt("return",e.sent.rewards);case 6:return e.prev=6,e.t0=e.catch(0),console.log("Error while generating delegator ".concat(t,": ").concat(e.t0.stack," ... (going to retry now)")),K(1e3),e.next=12,Object(y.getDelegatorStakingRewards)(t,r,n);case 13:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function L(e,t,r,n){return{guardianAddress:e.address,guardianName:e.details.name,guardianCertified:e.details.certified,type:t,delegatorAddress:n,rewards:r}}function Y(e,t,r){var n=r.period_in_blocks||w;if(e.periods.length>1&&e.periods[0].length<n&&!0===r.show_only_full_periods){e.total_length_of_periods=e.total_length_of_periods-e.periods[0].length,e.periods.shift(),e.number_of_periods=e.number_of_periods-1,e.end_of_periods_block=e.periods[0].end_block;var a,s=Object(m.a)(t);try{for(s.s();!(a=s.n()).done;){a.value.rewards.shift()}}catch(o){s.e(o)}finally{s.f()}}}function K(e){return new Promise((function(t){return setTimeout(t,e)}))}var X=r(339);function Z(e){return z.apply(this,arguments)}function z(){return(z=Object(u.a)(p.a.mark((function e(t){var r,n,a,s,o,c,i,l,u,d,f,b,h,g,k,_,y,w,x;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=new X.Workbook,n=r.addWorksheet("Report",{views:[{state:"frozen",ySplit:3}]}),a=["","","","",""],s=["","","","",""],o=["Guardian Address","Guardian Name","Certified","Type","Delegaor Address"],c=[],i=t.details.number_of_periods-1;i>=0;i--)a.push("".concat(q(t.details.periods[i].start_block_time)," to ").concat(q(t.details.periods[i].end_block_time)," GMT")),s.push("".concat(t.details.periods[i].start_block," to ").concat(t.details.periods[i].end_block," (").concat(t.details.periods[i].length," blocks)")),o.push("Distributed (ORBS)"),c.push(0);n.addRows([a,s,o]),l=Object(m.a)(t.participants);try{for(l.s();!(u=l.n()).done;){if(d=u.value,f=[d.guardianAddress,d.guardianName,d.guardianCertified,d.type,d.delegatorAddress||""],0===d.rewards.length)f.push("Missing Data");else{for(b=d.rewards.length;b<t.details.number_of_periods;b++)f.push(0);for(h=d.rewards.length-1;h>=0;h--)f.push(d.rewards[h]),"Total"===d.type&&(c[t.details.number_of_periods-1-h]=c[t.details.number_of_periods-1-h]+d.rewards[h])}n.addRow(f)}}catch(p){l.e(p)}finally{l.f()}for(g=n.addRow(["","","","","Total Distributed:"].concat(c)),n.getColumn(1).width=42,n.getColumn(2).width=35,n.getColumn(3).width=8,n.getColumn(4).width=35,n.getColumn(5).width=42,k=0;k<t.details.number_of_periods;k++)n.getColumn(6+k).width=40;for(n.getRow(3).font={bold:!0},_=4;_<4+t.participants.length;_++)for("Total"===(y=n.getRow(_)).getCell(4).value?(y.font={bold:!0},y.border={top:{style:"thin"}},y.getCell(5).border={top:{style:"thin"},right:{style:"thin"}}):y.getCell(5).border={right:{style:"thin"}},w=6;w<6+t.details.number_of_periods;w++)y.getCell(w).numFmt="#,##0.00";for(g.font={bold:!0},g.getCell(1).border={top:{style:"thin"}},g.getCell(2).border={top:{style:"thin"}},g.getCell(3).border={top:{style:"thin"}},g.getCell(4).border={top:{style:"thin"}},g.getCell(5).border={top:{style:"thin"},right:{style:"thin"}},x=6;x<6+t.details.number_of_periods;x++)g.getCell(x).numFmt="#,##0.00",g.getCell(x).border={top:{style:"double"}};return e.abrupt("return",r.xlsx.writeBuffer());case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){var t=new Date(1e3*e).toISOString();return t.slice(0,10)+" "+t.slice(11,19)}var $=r(28),ee={ethereum:"https://rpcman.orbs.network/rpc?chainId=1&appId=posReporter",polygon:"https://rpcman.orbs.network/rpc?chainId=137&appId=posReporter"},te={ethereum:["https://0xcore-management-direct.global.ssl.fastly.net/status"],polygon:["https://0xcore-matic-reader-direct.global.ssl.fastly.net/status"]},re={Quarterly:{ethereum:"604800",polygon:"3435449"},Monthly:{ethereum:"199385",polygon:"1132565"},Weekly:{ethereum:"46525",polygon:"264265"}};function ne(e,t,r,n){return ae.apply(this,arguments)}function ae(){return(ae=Object(u.a)(p.a.mark((function e(t,r,n,a){var s,o,c,i,l,u,d,f,b,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=ee[r],o=te[r],c=te.ethereum,e.next=5,Object(y.getWeb3)(ee.ethereum);case 5:if(i=e.sent,"Custom"!==t){e.next=27;break}if("polygon"!==r){e.next=16;break}return e.next=10,Object(y.getWeb3)(ee.polygon);case 10:return f=e.sent,e.next=13,f.eth.getBlock("latest");case 13:d=e.sent.number,e.next=19;break;case 16:return e.next=18,i.eth.getBlock("latest");case 18:d=e.sent.number;case 19:return b=d-parseInt(n),u={period_in_blocks:b,periods:1,show_only_full_periods:"true"===a},e.next=23,i.eth.getBlock(n);case 23:h=e.sent,l=[{number:h.number,time:h.timestamp}],e.next=32;break;case 27:return u={period_in_blocks:new Number(re[t].ethereum).valueOf(),periods:new Number(n).valueOf(),show_only_full_periods:"true"===a},e.next=30,T(u,i);case 30:l=e.sent,u.period_in_blocks=new Number(re[t][r]).valueOf();case 32:return e.next=34,R(s,r,o,c,u,l);case 34:return e.abrupt("return",e.sent);case 35:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function se(e,t){for(var r={details:e.details,participants:[]},n=e.participants.concat(t.participants),a=0;a<n.length-1;a++){for(var s=!1,o=function(e){if(n[a].guardianAddress===n[e].guardianAddress&&n[a].type===n[e].type&&(!["Delegator","Historical Delegator"].includes(n[a].type)||n[a].delegatorAddress===n[e].delegatorAddress)){s=!0;var t=n[a];return t.rewards=n[a].rewards.map((function(t,r){return t+n[e].rewards[r]})),r.participants.push(t),n.splice(e,1),"break"}},c=a+1;c<n.length;c++){if("break"===o(c))break}s||r.participants.push(n[a])}return r}function oe(e,t){var r=window.URL.createObjectURL(new Blob([e])),n=document.createElement("a");n.href=r,n.setAttribute("download","".concat(t,".").concat((new Date).toISOString(),".xlsx")),n.setAttribute("type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)}var ce=[{key:"Quarterly",text:"Quarterly (91 days)",value:"Quarterly"},{key:"Monthly",text:"Monthly (30 days)",value:"Monthly"},{key:"Weekly",text:"Weekly (7 days)",value:"Weekly"},{key:"Custom",text:"Custom (From block #)",value:"Custom"}],ie=[{key:"All",text:"All",value:"all"},{key:"Ethereum",text:"Ethereum",value:"ethereum"},{key:"Polygon",text:"Polygon",value:"polygon"}];var le=function(){var e=Object(n.useState)({reportType:"Quarterly",networkType:"all",reportPeriods:"3",reportShowFull:"false",reportFilenamePrefix:"report"}),t=Object(l.a)(e,2),r=t[0],a=t[1],s=Object(n.useState)(!1),o=Object(l.a)(s,2),d=o[0],g=o[1],m=function(e,t){var n=t.name,s=t.value;return a(Object(i.a)(Object(i.a)({},r),{},Object(c.a)({},n,s)))},k=r.reportType,_=r.networkType,y=r.reportPeriods,w=r.reportShowFull,x=r.reportFilenamePrefix,v=function(){var e=Object(u.a)(p.a.mark((function e(){var t,r,n,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(g(!0),t=null,"all"!==_){e.next=12;break}return e.next=5,ne(k,"ethereum",y,w);case 5:return r=e.sent,e.next=8,ne(k,"polygon",y,w);case 8:n=e.sent,t=se(r,n),e.next=15;break;case 12:return e.next=14,ne(k,_,y,w);case 14:t=e.sent;case 15:return a=["Total","Self-Share (guardian + self-delegate)","Total Delegators","Delegator","Historical Delegator"],t.participants.sort((function(e,t){return e.guardianAddress===t.guardianAddress?a.indexOf(e.type)-a.indexOf(t.type):e.guardianAddress>t.guardianAddress?1:-1})),e.next=19,Z(t);case 19:oe(e.sent,x),g(!1);case 22:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object($.jsxs)("div",{className:"App",children:[Object($.jsx)("h2",{children:"Orbs Rewards Report Generator"}),Object($.jsx)("br",{}),Object($.jsx)(f.a,{textAlign:"left",children:Object($.jsx)(b.a,{textAlign:"left",secondary:!0,style:{width:"50vw",margin:"auto"},children:Object($.jsxs)(h.a,{loading:d,onSubmit:v,spellcheck:"false",children:[Object($.jsx)(h.a.Select,{label:"Network",name:"networkType",options:ie,defaultValue:"all",onChange:m}),Object($.jsx)(h.a.Select,{label:"Report Type",name:"reportType",options:ce,defaultValue:"Quarterly",onChange:m}),Object($.jsx)(h.a.Input,{label:"Custom"===k?"From Block":"Number Of Report Periods",name:"reportPeriods",defaultValue:"3",onChange:m}),Object($.jsx)(h.a.Checkbox,{radio:!0,label:"Show Only Full Periods",name:"reportShowFull",value:"true",checked:"true"===r.reportShowFull,onChange:m}),Object($.jsx)(h.a.Checkbox,{radio:!0,label:"Show Last Partial Period",name:"reportShowFull",value:"false",checked:"false"===r.reportShowFull,onChange:m}),Object($.jsx)(h.a.Input,{label:"File Name Prefix",name:"reportFilenamePrefix",defaultValue:"report",onChange:m}),Object($.jsx)(h.a.Button,{primary:!0,children:"Submit"})]})})})]})};o.a.render(Object($.jsx)(a.a.StrictMode,{children:Object($.jsx)(le,{})}),document.getElementById("root"))}},[[729,1,2]]]);
//# sourceMappingURL=main.a6e2d355.chunk.js.map