{"version":3,"sources":["report.js","xls.js","App.js","index.js"],"names":["DefaultPeriodBlocks","DefaultAbsoluteStartBlock","getStartOfRewardsBlock","DefaultExcluded","getPeriodsReport","ethereumEndpoint","nodeEndpoints","options","a","interestingGuardians","calculateDelegators","excluded","exclude_guardians","_","getGuardians","g","includes","address","push","certified","forEach","getGuardiansPeriodsReport","guardianAddresses","isString","getWeb3","web3","generatePeriodDetails","reportDetails","participants","i","length","getGuardianPeriodsReport","guardianAddress","rewards","console","log","trimNonFullPeriodIfNeeded","details","eth","getBlock","maxEndBlock","periods","periodLength","period_in_blocks","maxPeriods","show_only_full_periods","txs","currEnd","number","currStart","totalLength","start_block","start_block_time","end_block","end_block_time","Promise","all","res","Number","timestamp","number_of_periods","total_length_of_periods","start_of_periods_block","end_of_periods_block","report","readOptions","read_from_block","participantsRewards","getGuardian","gInfo","stack","sleep","generateGuardianPeriodResults","generateParticipantObject","allGuardianRewards","guardianSelfRewards","sumDelegatorRewards","generateAllDelegatorPaticipationRewads","guardian","guardianShareToTotal","reward_status","delegator_reward_share","guardianShareToAllDelegatorsShare","periodRewardsAsGuardian","generatePeriodReport","reward_as_guardian_slices","periodRewardsAsDelegator","reward_as_delegator_slices","map","v","guaridan","periodsData","periodRewards","currPeriod","currPeriodReward","isUndefined","guardian_from","block_number","total_awarded","deltaReward","deltaBlocks","neededDelta","generateTypedDelegatorPaticipationRewads","delegators","delegators_left","isHistoric","delegator","drewards","readRetryDelegator","getDelegatorStakingRewards","type","delegatorAddress","guardianName","name","guardianCertified","shift","ms","resolve","setTimeout","reportToXlsx","workbook","Workbook","worksheet","addWorksheet","views","state","ySplit","header2","header3","header4","totals","toDate","addRows","participant","row","addRow","totalsRow","getColumn","width","getRow","font","bold","j","getCell","value","border","top","style","right","numFmt","xlsx","writeBuffer","seconds","d","Date","toISOString","slice","getReport","reportPeriodLength","reportNumberOfPeriods","reportShowOnlyFull","valueOf","downloadReport","reportFilenamePrefix","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","parentNode","removeChild","periodOptions","key","text","App","useState","reportType","reportPeriods","reportShowFull","input","setInput","loading","setLoading","handleChange","_e","handleSubmit","className","Container","textAlign","Segment","secondary","margin","Form","onSubmit","spellcheck","Select","label","defaultValue","onChange","Input","Checkbox","radio","checked","Button","primary","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.28bfacd4.chunk.js","sourcesContent":["/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport _  from 'lodash';\nimport { getDelegatorStakingRewards, getGuardian, getGuardians, getStartOfRewardsBlock, getWeb3 } from \"@orbs-network/pos-analytics-lib\";\n\nconst DefaultPeriodBlocks = 604800;\nconst DefualtPeriods = 3;\nconst DefaultAbsoluteStartBlock = getStartOfRewardsBlock();\nconst DefaultExcluded = ['0x4aca0c63e351b2ea44ee628425710e933b5b3396', '0xca0ff0479bd7f52e55e65da7b76074b477b734b3'];\n\nexport async function getPeriodsReport(ethereumEndpoint, nodeEndpoints, options) {\n    const interestingGuardians = [];\n    const calculateDelegators = [];\n    const excluded = options.exclude_guardians || DefaultExcluded;\n    _.forEach(await getGuardians(nodeEndpoints), g => {\n        if (!excluded.includes(g.address)) {\n            interestingGuardians.push(g.address);\n            calculateDelegators.push(!g.certified);\n        }\n    });\n\n    return getGuardiansPeriodsReport(interestingGuardians, calculateDelegators, ethereumEndpoint, options);\n}\n\nexport async function getGuardiansPeriodsReport(guardianAddresses, calculateDelegators, ethereumEndpoint, options) {\n    const web3 = _.isString(ethereumEndpoint) ? await getWeb3(ethereumEndpoint) : ethereumEndpoint;\n\n    const reportDetails = await generatePeriodDetails(options, web3);\n    const participants = [];\n\n    for (let i = 0;i < guardianAddresses.length;i++) {\n        try {\n             participants.push(...(await getGuardianPeriodsReport(guardianAddresses[i], calculateDelegators[i], web3, reportDetails)));\n        } catch (e) {\n            participants.push({guardianAddress: guardianAddresses[i], rewards: []});\n            console.log(`Error while generating guardian ${guardianAddresses[i]}: ${e} ... (skipped)`);\n        }\n    }\n\n    trimNonFullPeriodIfNeeded(reportDetails, participants, options);\n    \n    return {\n        details: reportDetails,\n        participants\n    }\n}\n\n// Generate full periods + partial (data always starts from )\nasync function generatePeriodDetails(options, web3) {\n    const maxEndBlock = await web3.eth.getBlock('latest');\n    const periods = []; \n    const periodLength = options.period_in_blocks || DefaultPeriodBlocks;\n    const maxPeriods = (options.periods || DefualtPeriods) + (options.show_only_full_periods === true ? 1 : 0);\n\n    const txs = [];\n    let currEnd = maxEndBlock.number;\n    let currStart = (maxEndBlock.number - periodLength + 1) > DefaultAbsoluteStartBlock.number\n        ? maxEndBlock.number - ((maxEndBlock.number - DefaultAbsoluteStartBlock.number) % periodLength)\n        : DefaultAbsoluteStartBlock.number;\n    let totalLength = 0;\n    do {\n        periods.push({\n            start_block: currStart,\n            start_block_time: 0,\n            end_block: currEnd,\n            end_block_time: 0,\n            length: currEnd-currStart+1\n        });\n        totalLength += (currEnd-currStart+1);\n        txs.push(web3.eth.getBlock(currStart));\n        currEnd = currStart - 1;\n        currStart = currEnd - periodLength + 1;    \n    } while (periods.length < maxPeriods && currStart >= DefaultAbsoluteStartBlock.number)\n\n    const res = await Promise.all(txs);\n    for(let i = 0;i < periods.length;i++) {\n        periods[i].end_block_time = Number(i === 0 ? maxEndBlock.timestamp : res[i-1].timestamp - 13);\n        periods[i].start_block_time = Number(res[i].timestamp);\n    }\n \n    return {\n        number_of_periods: periods.length,\n        total_length_of_periods: totalLength,\n        start_of_periods_block: periods[periods.length-1].start_block,\n        end_of_periods_block: periods[0].end_block, \n        periods,\n    }\n}\n\nasync function getGuardianPeriodsReport(address, calculateDelegators, web3, report) {\n    const readOptions = {\n        read_from_block: report.start_of_periods_block - 10000, /* need cushion for event to have before first block */\n    }\n    const participantsRewards = [];\n\n    let gInfo;\n    try {\n        gInfo = await getGuardian(address, web3, readOptions);\n    } catch (e) {\n        console.log(`Error while generating guardian ${address}: ${e.stack} ... (going to retry now)`);\n        sleep(1000); // just in case\n        gInfo = await getGuardian(address, web3, readOptions);\n    }\n    const res = generateGuardianPeriodResults(gInfo, report.periods);\n    participantsRewards.push(generateParticipantObject(gInfo, 'Total', res.allGuardianRewards));\n    participantsRewards.push(generateParticipantObject(gInfo, 'Self-Share (guardian + self-delegate)', res.guardianSelfRewards));\n    participantsRewards.push(generateParticipantObject(gInfo, 'Total Delegators', res.sumDelegatorRewards));\n\n    if (calculateDelegators) {\n        await generateAllDelegatorPaticipationRewads(gInfo, web3, readOptions, report.periods, participantsRewards);\n    }\n\n    return participantsRewards;\n}\n\nfunction generateGuardianPeriodResults(guardian, periods) {\n    const guardianShareToTotal = 1.0 / (1.0-guardian.reward_status.delegator_reward_share);\n    const guardianShareToAllDelegatorsShare = guardian.reward_status.delegator_reward_share / (1-guardian.reward_status.delegator_reward_share);\n\n    const periodRewardsAsGuardian = generatePeriodReport(guardian.reward_as_guardian_slices, guardian.address, periods);\n    const periodRewardsAsDelegator = generatePeriodReport(guardian.reward_as_delegator_slices, guardian.address, periods);\n    const guardianSelfRewards = [], sumDelegatorRewards = [];\n    for(let i = 0;i < periodRewardsAsGuardian.length;i++) {\n        guardianSelfRewards.push(periodRewardsAsGuardian[i] + periodRewardsAsDelegator[i]);\n        sumDelegatorRewards.push(periodRewardsAsGuardian[i] * guardianShareToAllDelegatorsShare - periodRewardsAsDelegator[i] )\n    }\n\n    return { \n        allGuardianRewards: _.map(periodRewardsAsGuardian, v => v * guardianShareToTotal),\n        sumDelegatorRewards, \n        guardianSelfRewards\n    };\n}\n\n// Assumptions:\n// 1. eigher the last reward is begining of time or there are more than needed.\n// 2. for delegators an assignreward event happends when change of delegation.\nfunction generatePeriodReport(rewards, guaridan, periodsData) {\n    const periodRewards = [];\n    let currPeriod = 0;\n    let currPeriodReward = 0;\n    for (let i = 0;currPeriod < periodsData.length && i < rewards.length-1;i++) {\n        if (_.isUndefined(rewards[i].guardian_from) || rewards[i].guardian_from === guaridan) { // count this delta\n            if (rewards[i+1].block_number >= periodsData[currPeriod].start_block) { // full 'delta' counted\n                currPeriodReward += rewards[i].total_awarded - rewards[i+1].total_awarded;\n            } else { // partial 'delta' counted \n                const deltaReward = rewards[i].total_awarded - rewards[i+1].total_awarded;\n                const deltaBlocks = rewards[i].block_number - rewards[i+1].block_number;\n                const neededDeltaBlocks = rewards[i].block_number - periodsData[currPeriod].start_block + 1;\n                const neededDelta = deltaReward * neededDeltaBlocks / deltaBlocks\n                currPeriodReward += neededDelta;\n                periodRewards.push(currPeriodReward);\n   \n                currPeriodReward = deltaReward - neededDelta;\n                currPeriod++;            \n            }\n        } else if (rewards[i+1].block_number <= periodsData[currPeriod].start_block) { // just check if next period\n            periodRewards.push(currPeriodReward);\n            currPeriodReward = 0;\n            currPeriod++;            \n        } \n    }\n    if (currPeriod < periodsData.length) {\n        periodRewards.push(currPeriodReward);\n    }\n\n    return periodRewards;\n}\n\nasync function generateAllDelegatorPaticipationRewads(guardian, web3, options, periods, participantsRewards) {\n    await generateTypedDelegatorPaticipationRewads(guardian, guardian.delegators, false, web3, options, periods, participantsRewards);\n    await generateTypedDelegatorPaticipationRewads(guardian, guardian.delegators_left, true, web3, options, periods, participantsRewards);\n}\n\nasync function generateTypedDelegatorPaticipationRewads(guardian, delegators, isHistoric, web3, options, periods, participantsRewards) {\n    for (const delegator of delegators) {\n        let drewards = []\n        try {\n            drewards = generatePeriodReport(await readRetryDelegator(delegator.address, web3, options), guardian.address, periods);\n        } catch (e) {\n            console.log(`Error while generating ${isHistoric ? \"historical\" : \"\" } delegator ${delegator.address}: ${e.stack} ... (skipped)`);\n        }\n        participantsRewards.push(generateParticipantObject(guardian, isHistoric ? 'Historical Delegator': 'Delegator', drewards, delegator.address));\n    }\n}\n\nasync function readRetryDelegator(address, web3, options) {\n    try {\n        return (await getDelegatorStakingRewards(address, web3, options)).rewards;\n    } catch (e) {\n        console.log(`Error while generating delegator ${address}: ${e.stack} ... (going to retry now)`);\n        sleep(1000); // just in case\n        return (await getDelegatorStakingRewards(address, web3, options)).rewards;\n    }\n}\n\nfunction generateParticipantObject(guardian, type, rewards, delegatorAddress) {\n    return {\n        guardianAddress: guardian.address,\n        guardianName: guardian.details.name,\n        guardianCertified: guardian.details.certified,\n        type,\n        delegatorAddress,\n        rewards\n    };\n}\n\nfunction trimNonFullPeriodIfNeeded(details, participants, options) {\n    const periodLength = options.period_in_blocks || DefaultPeriodBlocks;\n    if (details.periods.length > 1 && details.periods[0].length < periodLength && options.show_only_full_periods === true) {\n        details.total_length_of_periods = details.total_length_of_periods - details.periods[0].length;\n        details.periods.shift();\n        details.number_of_periods = details.number_of_periods - 1;\n        details.end_of_periods_block = details.periods[0].end_block;\n        for (const participant of participants) {\n            participant.rewards.shift();\n        }\n    }\n}\n\nfunction sleep(ms) {\n    return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter library in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport {Workbook} from 'exceljs';\n\nexport async function reportToXlsx(report) {\n    const workbook = new Workbook();  \n    const worksheet = workbook.addWorksheet('Report', {views:[{state: 'frozen', ySplit: 3}]});  \n    \n    // headers\n    const header2 = ['','','','',''], header3 = ['','','','',''], header4 = ['Guardian Address','Guardian Name', 'Certified', 'Type', 'Delegaor Address'];\n    const totals = []\n    for(let i = report.details.number_of_periods-1;i >= 0;i--) {\n        header2.push(`${toDate(report.details.periods[i].start_block_time)} to ${toDate(report.details.periods[i].end_block_time)} GMT`);\n        header3.push(`${report.details.periods[i].start_block} to ${report.details.periods[i].end_block} (${report.details.periods[i].length} blocks)`)\n        header4.push('Distributed (ORBS)');\n        totals.push(0);\n    }\n    worksheet.addRows([header2, header3, header4]);\n\n    // data\n    for (const participant of report.participants) {\n        const row = [\n            participant.guardianAddress, participant.guardianName, participant.guardianCertified, \n            participant.type, participant.delegatorAddress || '', ...participant.rewards\n        ];\n        if (participant.rewards.length === 0) {\n            row.push('Missing Data');\n        } else if (participant.type === 'Total') {\n            for (let i = 0;i < participant.rewards.length;i++) {\n                totals[i] = totals[i] + participant.rewards[i];\n            }\n        }\n        worksheet.addRow(row);\n    }\n    //worksheet.getCell('A3').value = { formula: 'A1+A2', result: 7 };\n    const totalsRow = worksheet.addRow(['','','','','Total Distributed:', ...totals]);\n    \n    // formatting\n    worksheet.getColumn(1).width = 42;\n    worksheet.getColumn(2).width = 35;\n    worksheet.getColumn(3).width = 8;\n    worksheet.getColumn(4).width = 35;\n    worksheet.getColumn(5).width = 42;\n    for(let i = 0;i < report.details.number_of_periods;i++) {\n        worksheet.getColumn(6+i).width = 40;  \n    }\n    worksheet.getRow(3).font = {bold: true};\n    for(let j=4;j < 4+report.participants.length;j++) {\n        const row = worksheet.getRow(j);\n        if (row.getCell(4).value === 'Total') {\n            row.font = {bold: true};\n            row.border = {top: {style:'thin'}};\n            row.getCell(5).border = {top: {style:'thin'}, right: {style:'thin'}};\n        } else {\n            row.getCell(5).border = {right: {style:'thin'}};\n        }\n        for(let i = 6;i < 6 + report.details.number_of_periods;i++) {\n            row.getCell(i).numFmt = \"#,##0.00\";\n        }\n\n    }\n    totalsRow.font = {bold: true};\n    totalsRow.getCell(1).border = {top: {style:'thin'}};\n    totalsRow.getCell(2).border = {top: {style:'thin'}};\n    totalsRow.getCell(3).border = {top: {style:'thin'}};\n    totalsRow.getCell(4).border = {top: {style:'thin'}};\n    totalsRow.getCell(5).border = {top: {style:'thin'}, right: {style:'thin'}};\n    for(let i = 6;i < 6 + report.details.number_of_periods;i++) {\n         totalsRow.getCell(i).numFmt = \"#,##0.00\";\n         totalsRow.getCell(i).border = {top: {style:'double'}};\n    }\n    \n    return workbook.xlsx.writeBuffer()\n}\n\nfunction toDate(seconds) {\n    const d = new Date(seconds * 1000).toISOString();\n    return d.slice(0,10) + ' ' + d.slice(11,19);\n}\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport React, { useState } from \"react\";\nimport { Container, Segment, Form } from \"semantic-ui-react\";\nimport \"./App.css\";\n\nimport { getGuardiansPeriodsReport, getPeriodsReport } from './report.js';\nimport { reportToXlsx } from './xls.js';\n\nasync function getReport(reportPeriodLength, reportNumberOfPeriods, reportShowOnlyFull) {\n    const ethereumEndpoint = 'https://mainnet.infura.io/v3/e0abafac3c8d46c3a9befb6e8b14abc9';\n    const nodeEndpoints = ['https://0xcore.orbs.com/services/management-service/status'];\n\n    const options = {\n      period_in_blocks: new Number(reportPeriodLength).valueOf(), \n      periods: new Number(reportNumberOfPeriods).valueOf(), \n      show_only_full_periods: reportShowOnlyFull === 'true'\n    };\n\n    //const report = await getGuardiansPeriodsReport(guardianAddresses, includeDelegators, ethereumEndpoint, options);\n    const report = await getPeriodsReport(ethereumEndpoint, nodeEndpoints, options)\n    return reportToXlsx(report);\n}\n\nfunction downloadReport(report, reportFilenamePrefix) {\n  const url = window.URL.createObjectURL(new Blob([report]));\n  const link = document.createElement('a');\n  link.href = url;\n  link.setAttribute('download', `${reportFilenamePrefix}.${new Date().toISOString()}.xlsx`);\n  link.setAttribute('type', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');\n  document.body.appendChild(link);\n  link.click();\n  link.parentNode.removeChild(link);\n}\n\nconst periodOptions = [\n  {\n    key: 'Quarterly',\n    text: 'Quarterly (91 days)',\n    value: '604800'\n  },\n  {\n    key: 'Monthly',\n    text: 'Monthly (30 days)',\n    value: '199385'\n  },\n  {\n    key: 'Weekly',\n    text: 'Weekly (7 days)',\n    value: '46525'\n  }\n];\n\nfunction App() {\n  const [input, setInput] = useState({reportType: '604800', reportPeriods: '3', reportShowFull: 'false', reportFilenamePrefix: \"report\"});\n  const [loading, setLoading] = useState(false);\n  const handleChange = (_e, { name, value }) => setInput({ ...input, [name]: value });\n  const handleSubmit = async () => {\n    const { reportType, reportPeriods, reportShowFull, reportFilenamePrefix } = input;\n    setLoading(true);\n    const result = await getReport(reportType, reportPeriods, reportShowFull);\n    downloadReport(result, reportFilenamePrefix);\n    setLoading(false);\n  };\n\n  return (\n    <div className=\"App\">\n     <h2>Orbs Rewards Report Generator</h2>\n      <br />\n      <Container textAlign=\"left\">\n      <Segment textAlign=\"left\" secondary style={{ width: \"50vw\", margin: \"auto\" }}>\n          <Form loading={loading} onSubmit={handleSubmit} spellcheck=\"false\">\n            <Form.Select\n              label=\"Report Type\"\n              name=\"reportType\"\n              options={periodOptions}\n              defaultValue=\"604800\"\n              onChange={handleChange}\n            />\n            <Form.Input\n              label=\"Number Of Report Periods\"\n              name=\"reportPeriods\"\n              defaultValue=\"3\"\n              onChange={handleChange}\n            />\n            <Form.Checkbox\n              radio\n              label=\"Show Only Full Periods\"\n              name=\"reportShowFull\"\n              value=\"true\"\n              checked={input.reportShowFull === 'true'}\n              onChange={handleChange}\n            />\n            <Form.Checkbox\n              radio\n              label=\"Show Last Partial Period\"\n              name=\"reportShowFull\"\n              value=\"false\"\n              checked={input.reportShowFull === 'false'}\n              onChange={handleChange}\n            />\n            <Form.Input\n              label=\"File Name Prefix\"\n              name=\"reportFilenamePrefix\"\n              defaultValue=\"report\"\n              onChange={handleChange}\n            />\n            <Form.Button primary>Submit</Form.Button>\n          </Form>\n        </Segment>\n     </Container>\n    </div>\n  );\n}\n\nexport default App;\n","/**\n * Copyright 2021 the pos-reporter authors\n * This file is part of the pos-reporter in the Orbs project.\n *\n * This source code is licensed under the MIT license found in the LICENSE file in the root directory of this source tree.\n * The above notice should be included in all copies or substantial portions of the software.\n */\n\nimport React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"semantic-ui-css/semantic.min.css\";\nimport \"./index.css\";\nimport App from \"./App\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);"],"sourceRoot":""}